/*1357530920,173217321*/

if (self.CavalryLogger) { CavalryLogger.start_js(["Xta22"]); }

__d("ContainerDimensionsUtils",["Event","Style","Vector","EagleEye","DOM"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Style'),i=b('Vector'),j=b('EagleEye'),k=b('DOM');f.onDimensionsReady=function(l,m){var n=k.scry(l,'img.img'),o=n.length;if(o){var p=function(){--o;if(!o)m.defer();};n.forEach(function(q){if(q.complete){p();}else g.listen(q,{load:p,error:p,abort:p});});}else m.defer();};f.log=function(l,m,n,o){var p=l.parentNode;if(p)f.onDimensionsReady(p,function(){var q=i.getElementDimensions(p),r=i.getElementPosition(p),s=parseInt(h.get(p,'marginBottom'),10);j.log(m,[o,q.x,q.y+s,r.x,r.y,n]);});};});
__d("ComposerXEmptyAttachment",["Class","ComposerXAttachment","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('ComposerXAttachment'),i=b('copyProperties');function j(k,l){this.parent.construct(this);this._root=k;if(l)this.attachmentClassName=l;}g.extend(j,h);i(j.prototype,{getRoot:function(){return this._root;}});e.exports=j;});
__d("TimelineStickyHeaderComposerX",["Event","Arbiter","Bootloader","CSS","ComposerXController","DOMQuery","Parent","Run","TimelineComposerUtilities","TimelineContentLoader","TimelineStickyHeader","Vector","copyProperties","csx","cx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('Bootloader'),j=b('CSS'),k=b('ComposerXController'),l=b('DOMQuery'),m=b('Parent'),n=b('Run'),o=b('TimelineComposerUtilities'),p=b('TimelineContentLoader'),q=b('TimelineStickyHeader'),r=b('Vector'),s=b('copyProperties'),t=b('csx'),u=b('cx');function v(x){return x&&m.byClass(x.getContext(),"_2wp");}function w(x){this._composerRoot=x;this._tokens=[o.listenToSetEstimatedDate(this._composerRoot,p.capsuleForCurrentSection),o.listenToPublish(this._composerRoot,this._close.bind(this)),h.subscribe('PhotoSnowlift.OPEN',this._close.bind(this)),h.subscribe('TimelineMLE/mleFlyoutShown',function(y,z){if(v(z)===this._composerRoot)k.reset(this._composerRoot);}.bind(this)),h.subscribe('composer/initializedAttachment',function(y,z){if(z.composerRoot===this._composerRoot){this._registerClickToDismiss();if(!z.isInitial)this._closeMLE();}else this._close();}.bind(this)),h.subscribe(q.ADJUST_WIDTH,this._toggleNarrowMode.bind(this))];this._clickCancelToken=o.listenToCancel(this._composerRoot,this._close.bind(this));n.onLeave(function(){while(this._tokens.length)this._tokens.pop().unsubscribe();this._clearClickDismissToken();if(this._clickCancelToken){this._clickCancelToken.remove();this._clickCancelToken=null;}}.bind(this));}s(w.prototype,{_toggleNarrowMode:function(event,x){i.loadModules(['Tooltip'],function(y){var z=r.getElementDimensions(x).x>400,aa=l.scry(this._composerRoot,"._9lb");j.conditionClass(this._composerRoot,"_2wq",z);for(var ba=0;ba<aa.length;ba++){var ca=aa[ba],da=l.getText(ca);if(z){y.set(ca,da);}else y.remove(ca);}}.bind(this));return false;},_registerClickToDismiss:function(){var x=j.hasClass(l.find(this._composerRoot,"._yq"),"_4n");if(!x){this._clearClickDismissToken();return;}this._clickDismissToken=g.listen(document.body,'click',function(y){var z=m.byClass(y.getTarget(),"_2wp");if(!z){this._close();this._clearClickDismissToken();}}.bind(this));},_clearClickDismissToken:function(){if(this._clickDismissToken){this._clickDismissToken.remove();this._clickDismissToken=null;}},_close:function(){this._clearClickDismissToken();this._closeMLE();k.reset(this._composerRoot);},_closeMLE:function(){i.loadModules(['TimelineMLE'],function(x){var y=x.getFlyout();if(v(y)===this._composerRoot)x.hideFlyout();}.bind(this));}});e.exports=w;});
__d("TimelineScrubber",["Event","CSS","DOM","Focus","Keys","Parent","TimelineController","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('Focus'),k=b('Keys'),l=b('Parent'),m=b('TimelineController'),n=b('Vector'),o=b('copyProperties');function p(q){this._root=q;this._navKeys={};this._subNavKeys={};this._rollups={};this._rolledup={};var r=q.childNodes;this._currentNav=r[0];for(var s=0;s<r.length;s++){var t=r[s].getAttribute('data-key');this._navKeys[t]=r[s];var u=i.scry(r[s],'ul');this._subNavKeys[t]={};if(u.length){var v=u[0].childNodes;for(var w=0;w<v.length;w++)this._subNavKeys[t][v[w].getAttribute('data-key')]=v[w];}var x=r[s].getAttribute('data-rollup');if(x){this._rollups[x]=this._rollups[x]||[];this._rollups[x].push(r[s]);}}this._clickListener=g.listen(this._root,'click',this._handleScrub.bind(this));this._focusHandler=g.listen(this._root,'keydown',this._moveFocus.bind(this));this._tabbableElement=i.scry(this._root,'a')[0];h.show(this._root);var y=n.getViewportDimensions().y-this.SCRUBBER_NO_ADS_VERTICAL_BUFFER,z=this.getHeight();if(z>y)this.fold(z-y);m.register(m.SCRUBBER,this);m.scrubberHasLoaded(this);}o(p.prototype,{KEY_HEIGHT:23,SUBKEY_HEIGHT:16,OFFSET:38,SCRUBBER_NO_ADS_VERTICAL_BUFFER:125,reset:function(){this._root=null;this._navKeys={};this._subNavKeys={};this._rollups={};this._rolledup={};},getRoot:function(){return this._root;},getNav:function(q){return this._navKeys[q];},getSubnav:function(q,r){return this._subNavKeys[q][r];},getHeight:function(){return this._root.offsetHeight;},getLabelForNav:function(q){var r=this.getNav(q);return r&&i.getText(i.scry(r,'a')[0]);},getLabelForSubnav:function(q,r){var s=this.getSubnav(q,r);return s&&i.getText(i.scry(s,'a')[0]);},fold:function(q){return this._adjustFolding(q,true);},unfold:function(q){return this._adjustFolding(q,false);},getOffset:function(){return this.OFFSET+(h.hasClass(document.body,'hasVoiceBar')?26:0)+(h.hasClass('rightColContent','pagesTimelineRightColumn')?48:0);},updateSection:function(q,r){var s=this._navKeys[q].getAttribute('data-rollup');if(this._currentRollup&&this._currentRollup!=s){h.removeClass(this._currentRollup,'selected');h.removeClass(i.scry(this._currentRollup,'ul')[0],'loaded');delete this._currentRollup;}if(s&&this._rolledup[s]){var t=this._rolledup[s];if(t.getAttribute('data-rollup')){this._currentRollup=t;h.addClass(this._currentRollup,'selected');h.addClass(i.scry(this._currentRollup,'ul')[0],'loaded');}}this._currentNav&&h.removeClass(this._currentNav,'selected');this._currentSubNav&&h.removeClass(this._currentSubNav,'selected');this._currentNav=null;this._currentSubNav=null;if(this._navKeys[q]){this._currentNav=this._navKeys[q];h.addClass(this._currentNav,'selected');if(this.decadesAreSelectable&&this._navKeys[r]){this._currentSubNav=this._navKeys[r];h.addClass(this._currentSubNav,'selected');}else if(r&&this._subNavKeys[q][r]){this._currentSubNav=this._subNavKeys[q][r];h.addClass(this._currentSubNav,'selected');}}},_getRollupSize:function(q){var r=this._currentNav,s=r&&r.getAttribute('data-rollup'),t=this.KEY_HEIGHT*(this._rollups[q].length-1);if(q==s){t+=this.SUBKEY_HEIGHT*i.scry(r,'li').length;t-=this.SUBKEY_HEIGHT*(this._rollups[q].length-1);}return t;},_adjustFolding:function(q,r){var s=q,t=Object.keys(this._rollups);while(q>0&&t.length){var u=t[r?'pop':'shift']();if(!r==!this._rolledup[u])continue;var v=this._getRollupSize(u);if(v<=0)continue;if(!r&&v>q)break;this[r?'_collapseRollup':'_expandRollup'](u);q-=v;}return s-q;},_collapseRollup:function(q){var r=this._rollups[q];if(!r||r.length<2||this._rolledup[q])return;var s=r[0].previousSibling,t=r[0],u=i.create('a',{href:t.firstChild.href,rel:'ignore',tabindex:'-1'},[q]),v=i.create('ul',{className:'clearfix'});for(var w=0;w<r.length;w++)v.appendChild(r[w]);var x=i.create('li',null,[u,v]);if(this.decadesAreSelectable){var y=r[r.length-1],z=t.getAttribute('data-key')+y.getAttribute('data-key');x.setAttribute('data-start',y.getAttribute('data-start'));x.setAttribute('data-end',t.getAttribute('data-end'));x.setAttribute('data-key',z);this._navKeys[z]=x;}else x.setAttribute('data-key',t.getAttribute('data-key'));x.setAttribute('data-rollup',q);if(s){i.insertAfter(s,x);}else i.prependContent(this._root,x);this._rolledup[q]=x;this._checkSelection();this._ensureFocusableElementIsVisible();},_expandRollup:function(q){if(!this._rolledup[q])return;var r=this._rolledup[q],s=i.scry(r,'ul')[0],t=document.createDocumentFragment();while(s.childNodes.length)t.appendChild(s.firstChild);i.replace(r,t);this._rolledup[q]=false;this._checkSelection();},_checkSelection:function(){if(this._currentNav){var q=this._currentSubNav&&this._currentSubNav.getAttribute('data-key');this.updateSection(this._currentNav.getAttribute('data-key'),q);}},_handleScrub:function(event){var q=event.getModifiers();if(event.isMiddleClick()||q.access||q.meta)return true;var r=l.byTag(event.getTarget(),'a'),s=r&&l.byAttribute(r,'data-key');if(s){m.scrubberWasClicked(s.getAttribute('data-key'));m.navigateToSection(s.getAttribute('data-key'));return event.prevent();}},_ensureFocusableElementIsVisible:function(){while(!(this._tabbableElement.offsetHeight||this._tabbableElement.offsetWidth)){this._tabbableElement.tabIndex=-1;var q=l.byTag(l.byTag(this._tabbableElement,'li'),'li');this._tabbableElement=i.scry(q,'a')[0];this._tabbableElement.tabIndex=0;}},_moveFocus:function(event){if(event.getModifiers().any)return;var q=g.getKeyCode(event);if(q===k.UP||q===k.DOWN){var r=i.scry(this._root,'a').filter(function(u){return u.offsetHeight||u.offsetWidth;}),s=r.indexOf(this._tabbableElement);if(s!=-1){var t=r[s+(q===k.UP?-1:1)];if(t){t.tabindex=0;j.set(t);this._tabbableElement.tabindex=-1;this._tabbableElement=t;event.prevent();}}}}});e.exports=p;});
__d("TimelineMainScrubber",["Arbiter","Class","CSS","DOMQuery","TimelineConstants","TimelineController","TimelineScrubber","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Class'),i=b('CSS'),j=b('DOMQuery'),k=b('TimelineConstants'),l=b('TimelineController'),m=b('TimelineScrubber'),n=b('copyProperties');function o(p){this.parent.construct(this,p);this._subscribe=g.subscribe(k.SECTION_LOADED,function(q,r){var s=this._navKeys[r.key],t=s&&j.scry(s,'ul')[0];if(t){i.addClass(t,'loaded');l.scrubberHasChangedState();if(r.hideSubSections)i.hide(t);}}.bind(this));}h.extend(o,m);n(o.prototype,{reset:function(){this.parent.reset();this._subscribe&&this._subscribe.unsubscribe();}});e.exports=o;});
__d("legacy:TimelineMainScrubber",["TimelineMainScrubber"],function(a,b,c,d){a.TimelineMainScrubber=b('TimelineMainScrubber');},3);