/*1362518480,173213727*/

if (self.CavalryLogger) { CavalryLogger.start_js(["W6nOB"]); }

__d("MercuryTypingIndicator",["CSS","MercuryIndicatorController","DOM","MercuryParticipants","ChatTabTemplates","Tooltip","copyProperties","cx","tx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('MercuryIndicatorController'),i=b('DOM'),j=b('MercuryParticipants'),k=b('ChatTabTemplates'),l=b('Tooltip'),m=b('copyProperties'),n=b('cx'),o=b('tx');function p(r){var s=k[':fb:chat:conversation:message-group'].build(),t=k[':fb:mercury:typing-indicator:typing'].build();g.addClass(s.getRoot(),"_50kd");var u=s.getNode('profileLink');l.set(u,r.name,'left');u.href=r.href;s.setNodeContent('profileName',r.name);s.setNodeProperty('profilePhoto','src',r.image_src);var v=o._("{name} is typing...",{name:r.short_name});l.set(t.getRoot(),v,'above');i.appendContent(s.getNode('messages'),t.getRoot());return s;}function q(r,s,t){this._typingIndicator=s;this._messagesView=t;this._controller=new h(r);this._subscription=this._controller.subscribe('state-changed',this._handleStateChanged.bind(this));}m(q.prototype,{destroy:function(){this._subscription.unsubscribe();this._controller.destroy();},setLastMessage:function(r){this._controller.setLastMessage(r);},_handleStateChanged:function(r,s){var t=this._messagesView.isScrolledToBottom();this._rerender(s);t&&this._messagesView.scrollToBottom();},_rerender:function(r){i.empty(this._typingIndicator);if(r.activity=='typing'&&r.typing)j.getMulti(r.typing,function(s){for(var t in s)i.appendContent(this._typingIndicator,p(s[t]).getRoot());}.bind(this));}});e.exports=q;});