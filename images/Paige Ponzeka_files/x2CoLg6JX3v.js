/*1361764034,178142525*/

if (self.CavalryLogger) { CavalryLogger.start_js(["EvvXr"]); }

__d("StickyController",["Event","CSS","Style","Vector","copyProperties","queryThenMutateDOM"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('Style'),j=b('Vector'),k=b('copyProperties'),l=b('queryThenMutateDOM');function m(n,o,p,q){this._element=n;this._marginTop=o;this._onchange=p;this._proxy=q||n.parentNode;this._boundQueryOnScroll=this._queryOnScroll.bind(this);this._boundMutateOnScroll=this._mutateOnScroll.bind(this);}k(m.prototype,{handleScroll:function(){l(this._boundQueryOnScroll,this._boundMutateOnScroll);},_queryOnScroll:function(){this._shouldFix=j.getElementPosition(this._proxy,'viewport').y<=this._marginTop;},_mutateOnScroll:function(){var n=this._shouldFix;if(this.isFixed()!==n){i.set(this._element,'top',n?this._marginTop+'px':'');h.conditionClass(this._element,'fixed_elem',n);this._onchange&&this._onchange(n);}},start:function(){if(this._event)return;this._event=g.listen(window,'scroll',this.handleScroll.bind(this));this.handleScroll.bind(this).defer();},stop:function(){this._event&&this._event.remove();this._event=null;},isFixed:function(){return h.hasClass(this._element,'fixed_elem');}});e.exports=m;});
__d("TimelineSideAds",["function-extensions","Arbiter","CSS","DOM","EgoAdsObjectSet","Event","StickyController","TimelineConstants","TimelineController","UIPagelet","URI","Vector","cx","csx","debounce","ge"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('EgoAdsObjectSet'),k=b('Event'),l=b('StickyController'),m=b('TimelineConstants'),n=b('TimelineController'),o=b('UIPagelet'),p=b('URI'),q=b('Vector'),r=b('cx'),s=b('csx'),t=b('debounce'),u=b('ge'),v=2,w=3,x=75,y='data-height',z=30000,aa=0,ba=false,ca,da,ea,fa,ga,ha=new j(),ia,ja=false,ka,la=Infinity,ma=5,na=false,oa,pa,qa,ra,sa,ta=false,ua=[],va;function wa(tb,ub,vb){var wb=0;if(ub)wb+=ub.getHeight();if(!bb()&&!wb)return;tb-=wb;var xb=0;for(var yb=0;yb<vb;yb++)xb+=kb(yb);if(ub)if(tb<xb){tb+=ub.fold(xb-tb);}else if(tb>xb)tb-=ub.unfold(tb-xb);return tb;}function xa(){var tb=da.cloneNode(true);tb.id='';var ub=new j();ub.init(i.scry(tb,'div.ego_unit'));var vb=true;ub.forEach(function(wb){if(vb){vb=false;}else i.remove(wb);});h.addClass(tb,'fixed_elem');return tb;}function ya(){ga=undefined;if(!n.pageHasScrubber(ia)){cb(ma);fb();}else if(pa){db(da,false);var tb=qa;qa&&i.remove(qa);qa=xa();if(tb)qb();cb(n.sidebarInitialized()&&ja?w:v);fb();if(!ka){var ub=n.getCurrentScrubber();if(ub)pb(ub.getRoot(),ub.getOffset());}ka&&ka.start();}else sb.adjustAdsToFit();}function za(){if(qa){i.remove(qa);qa=null;}if(ka){ka.stop();ka=null;}if(bb()){h.conditionClass(da,'fixed_elem',!pa);h.conditionClass(da,"_22s",!n.pageHasScrubber(ia));}else h.conditionClass(da,'fixed_elem',!pa&&n.pageHasScrubber(ia));}function ab(tb){var ub=q.getViewportDimensions().y,vb=n.getCurrentScrubber(),wb=vb?vb.getOffset():m.SCRUBBER_DEFAULT_OFFSET,xb=ub-wb-x;if(vb||bb())return wa(xb,vb,tb);}function bb(){return n.fixedAds();}function cb(tb){fa=Math.min(tb,ha.getCount());ha.forEach(function(ub,vb){db(ub,vb>=fa);});db(da,fa===0);}function db(tb,ub){h.conditionClass(tb,"_22r",ub);tb.setAttribute('aria-hidden',ub?'true':'false');}function eb(tb){var ub=i.find(ha.getUnit(tb),"div._4u8"),vb=ub.getAttribute('data-ad');return JSON.parse(vb).adid;}function fb(){hb();gb();}function gb(){var tb;if(ga!==undefined){tb=ha.getHoldoutAdIDsForSpace(ga,lb);}else tb=ha.getHoldoutAdIDsForNumAds(fa);if(tb)tb.forEach(ib);}function hb(){if(!ra)return;for(var tb=fa-1;tb>=0;--tb){if(ka&&ka.isFixed()&&((tb!==0)||(qa&&!h.shown(qa))))continue;var ub=eb(tb);if(!ra[ub])return;ib(ub);}}function ib(tb){if(!ra[tb])return;var ub=i.create('iframe',{src:p('/ai.php').addQueryData({aed:ra[tb]}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});ub.setAttribute('aria-hidden','true');i.appendContent(da,ub);delete ra[tb];}function jb(tb){var ub=0;while(tb>0&&ub<ma){tb-=kb(ub);if(tb>=0)ub++;}return ub;}function kb(tb){var ub=ha.getUnit(tb);if(!ub)return 0;return lb(ub);}function lb(tb){if(!tb.getAttribute(y))mb(tb);return parseInt(tb.getAttribute(y),10);}function mb(tb){tb.setAttribute(y,tb.offsetHeight);}function nb(){for(var tb=0;tb<ha.getCount();tb++){var ub=ha.getUnit(tb);if(!ub)continue;mb(ub);}}function ob(){var tb=i.scry(da,'div.ego_unit');ha.init(tb);var ub=tb.length;if(!ub)return;h.addClass(ha.getUnit(0),'ego_unit_no_top_border');na=ub;ya();var vb=function(wb){mb(wb);na=--ub;sb.adjustAdsToFit();if(!na)la=Date.now();};tb.forEach(function(wb){function xb(){vb.curry(wb).defer();}var yb=i.scry(wb,'img.img')[0];if(!yb)return;if(yb.complete){xb();}else k.listen(yb,{load:xb,error:xb,abort:xb});});}function pb(tb,ub){ka=new l(tb,ub,function(vb){if(vb){qb();}else{i.remove(qa);fb();}});if(qa)ka.start();}function qb(){i.insertAfter(da,qa);rb();}function rb(){h.conditionShow(qa,kb(0)<=ab(1)&&!h.hasClass(document.documentElement,'tinyViewport'));}var sb={init:function(tb,ub,vb){if(ba)return;ma=vb.max_ads;ca=vb.refresh_delay;z=vb.refresh_threshold;ba=true;ea=ub;da=tb;sb.adjustAdsType(n.shouldShowWideAds());sa=g.subscribe(['UFI/CommentAddedActive','UFI/CommentDeletedActive','UFI/LikeActive','Curation/Action','ProfileBrowser/LoadMoreContent','Ads/NewContentDisplayed'],sb.loadAdsIfEnoughTimePassed);va=t(sb.loadAdsIfEnoughTimePassed,ca,this,true);if(vb.mouse_move){ua.push(k.listen(window,'mousemove',va));ua.push(k.listen(window,'scroll',va));ua.push(k.listen(window,'resize',va));}n.register(n.ADS,sb);},setShortMode:function(tb){pa=tb;},start:function(tb){ra=tb;oa=null;ob();},updateCurrentKey:function(tb){if(tb==ia)return;ia=tb;za();},loadAds:function(tb){if(na||oa)return;la=Infinity;oa=o.loadFromEndpoint('WebEgoPane',da.id,{pid:33,data:[ea,false,'timeline_'+tb,pa?w:ma,++aa]},{crossPage:true,bundle:false});},registerScrubber:function(tb){if(pa)pb(tb.getRoot(),tb.getOffset());!oa&&sb.adjustAdsToFit();},loadAdsIfEnoughTimePassed:function(){if(z&&(Date.now()-la>=z)&&!h.hasClass(document.documentElement,'tinyViewport')&&(!ka||ka.isFixed())&&(!ra||!ra[eb(0)]))sb.loadAds(ia);sb.adjustAdsToFit();},adjustAdsType:function(tb){if(tb!=ja){h.conditionClass(da,"_22q",!tb);h.conditionClass(da,"_35q",!tb);qa&&h.conditionClass(qa,"_22q",!tb);qa&&h.conditionClass(qa,"_35q",!tb);ja=tb;nb();sb.adjustAdsToFit();var ub=u('rightColContent');if(ub)h.conditionClass(ub,'fbTimelineWideRightCol',tb);}},adjustAdsToFit:function(){if(!da||ta)return;ta=true;var tb=ja?w:v;if(pa){if(ka&&qa){ka.handleScroll();if(ka.isFixed()){h.conditionShow(qa,kb(0)<=ab(1)&&!h.hasClass(document.documentElement,'tinyViewport'));}else cb(tb);fb();}}else{var ub=ab(tb);if(typeof ub!=='undefined'){ga=ub;cb(jb(ub));if(!na)fb();}}ta=false;},reset:function(){ka&&ka.stop();oa&&oa.cancel();ha=new j();ja=false;da=null;ka=null;oa=null;aa=0;na=null;pa=null;qa=null;ia=null;la=Infinity;ba=false;sa&&g.unsubscribe(sa);sa=null;ua.forEach(function(tb){tb.remove();});ua=[];va&&va.reset();}};e.exports=a.TimelineSideAds||sb;});