/*1362572401,173220389*/

if (self.CavalryLogger) { CavalryLogger.start_js(["zZxIK"]); }

__d("FriendBrowserCheckboxController",["AsyncRequest","CSS","DOM","Event","Form","OnVisible","$","bind","copyProperties","ge"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('DOM'),j=b('Event'),k=b('Form'),l=b('OnVisible'),m=b('$'),n=b('bind'),o=b('copyProperties'),p=b('ge');function q(){}o(q,{instances:{},getInstance:function(r){return this.instances[r];}});o(q.prototype,{init:function(r,s,t){q.instances[r]=this;this._id=r;this._simplified=t;this._form=s;this._contentGrid=i.find(s,'.friendBrowserCheckboxContentGrid');this._loadingIndicator=i.find(s,'.friendBrowsingCheckboxContentLoadingIndicator');this._checkboxResults=i.find(s,'.friendBrowserCheckboxResults');this._contentPager=i.find(s,'.friendBrowserCheckboxContentPager');this.numGetNewRequests=0;this.queuedRequests={};j.listen(this._form,'submit',this.onFormSubmit.bind(this));},addTypeahead:function(r,s){r.subscribe('select',this.onHubSelect.bind(this,r,s));if(this._simplified)r.subscribe('unselect',this.onHubSelect.bind(this,r,s));},onFormSubmit:function(){this.getNew(true);return false;},addSelector:function(r){r.subscribe('change',this.getNew.bind(this,false));},onHubSelect:function(r,s,event,t){if(this._simplified){this.getNew(true);return;}if(!((event=='select')&&t.selected))return;var u=this.buildNewCheckbox(s,t.selected.text,t.selected.uid),v=i.find(this._form,'.checkboxes_'+s);i.appendContent(v.firstChild,u);var w=i.scry(r.getElement(),'input[type="button"]');if(w&&w[0])w[0].click();this.getNew(true);},buildNewCheckbox:function(r,s,t){var u=r+'_ids_'+t,v=r+'_ids[]',w=i.create('input',{id:u,type:'checkbox',value:t,name:v,checked:true});j.listen(w,'click',n(this,'getNew',false));var x=i.create('td',null,w);h.addClass(x,'vTop');h.addClass(x,'hLeft');var y=i.create('label',null,s),z=i.create('td',null,y);h.addClass(z,'vMid');h.addClass(z,'hLeft');var aa=i.create('tr');aa.appendChild(x);aa.appendChild(z);return aa;},showMore:function(){var r=i.scry(this._contentPager,'.friendBrowserMorePager')[0];if(!r)return false;if(h.hasClass(r,'async_saving'))return false;var s=this.numGetNewRequests,t=k.serialize(this._form);t.show_more=true;var u=new g().setURI('/ajax/growth/friend_browser/checkbox.php').setData(t).setHandler(n(this,function(v){this.showMoreHandler(v,s);})).setStatusElement(r).send();},showMoreHandler:function(r,s){if(s==this.numGetNewRequests){var t=r.payload;i.appendContent(this._contentGrid,t.results);this.updatePagerAndExtraData(t.pager,t.extra_data);}},getNew:function(r){this.numGetNewRequests++;var s=this.numGetNewRequests;h.addClass(this._checkboxResults,'friendBrowserCheckboxContentOnload');if(p('friendBrowserCI'))h.addClass(m('friendBrowserCI'),'friendBrowserCheckboxContentOnload');h.show(this._loadingIndicator);var t=k.serialize(this._form);t.used_typeahead=r;new g().setURI('/ajax/growth/friend_browser/checkbox.php').setData(t).setHandler(n(this,function(u){this.getNewHandler(u,s);})).send();},getNewHandler:function(r,s){if(s==this.numGetNewRequests){var t=r.payload;i.setContent(this._contentGrid,t.results);h.removeClass(this._checkboxResults,'friendBrowserCheckboxContentOnload');if(p('friendBrowserCI'))h.hide(m('friendBrowserCI'));h.hide(this._loadingIndicator);this.updatePagerAndExtraData(t.pager,t.extra_data);}},updatePagerAndExtraData:function(r,s){i.setContent(this._contentPager,r);this.setupOnVisible();i.replace(this._form.elements.extra_data,s);},setupOnVisible:function(){var r=i.scry(this._contentPager,'.friendBrowserMorePager')[0];if(r&&this._id!='jewel'){this._onVisible&&this._onVisible.remove();this._onVisible=new l(r,n(this,'showMore'),false,1000);}}});e.exports=q;});
__d("ContextualHelpSearchController",["Event","AsyncRequest","DOM","CSS","Focus","Input","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('DOM'),j=b('CSS'),k=b('Focus'),l=b('Input'),m=b('copyProperties'),n=350;function o(){this._token=null;this._timerID=0;this._lastQuery=null;this.typing_listener=null;this.clear_listener=null;this.async_request=null;}m(o.prototype,{init:function(p,q,r,s,t){this.loader=p;this.search_box=q;this.topics_area=r;this.results_area=s;this.clear_button=t;this.typing_listener=g.listen(this.search_box,'keyup',this.setTimer.bind(this));this.clear_listener=g.listen(this.clear_button,'click',this.clearResults.bind(this));k.set(this.search_box);},source:'contextual_help',clearResults:function(){this.show(this.topics_area);this._lastQuery='';l.reset(this.search_box);k.set(this.search_box);if(this.async_request!==null){this.async_request.abort();this.async_request=null;}j.addClass(this.clear_button,'hidden_elem');},update:function(){var p=l.getValue(this.search_box);if(p===this._lastQuery)return;this._lastQuery=p;if(p===''){this.clearResults();return;}this.show(this.loader);var q={query:p,width:this._width||n,source:this.source};this.async_request=new h('/help/ajax/search/').setData(q).setHandler(function(r){this._update(r);}.bind(this));this.async_request.send();},_update:function(p){this.async_request=null;var q=p.getPayload().results;i.setContent(this.results_area,q);this.show(this.results_area);if(l.getValue(this.search_box)===''){this.clearResults();}else j.removeClass(this.clear_button,'hidden_elem');},setTimer:function(){if(this._timerID!==0)clearTimeout(this._timerID);this._timerID=setTimeout(this.update.bind(this),300);if(this.async_request!=null){this.async_request.abort();this.async_request=null;}},show:function(p){var q=[this.loader,this.topics_area,this.results_area];for(var r=0;r<q.length;r++)j.addClass(q[r],'hidden_elem');j.removeClass(p,'hidden_elem');}});e.exports=o;});
__d("RequestsJewel",["Arbiter","AsyncRequest","AsyncSignal","ChannelConstants","CSS","DOM","Event","FriendBrowserCheckboxController","LinkController","Parent","ScrollableArea","Vector","copyProperties","ge","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AsyncSignal'),j=b('ChannelConstants'),k=b('CSS'),l=b('DOM'),m=b('Event'),n=b('FriendBrowserCheckboxController'),o=b('LinkController'),p=b('Parent'),q=b('ScrollableArea'),r=b('Vector'),s=b('copyProperties'),t=b('ge'),u=b('tx');function v(){}s(v,{instance:null,getInstance:function(){return this.instance;}});s(v.prototype,{init:function(w,x,y){v.instance=this;this.countNew=0;this.jewel=w;this.jewelFlyoutCase=w.getRoot();this.jewelFlyout=t('fbRequestsFlyout');this.newCountSpan=t('newRequestCount');this.folder=x;this.doNewMarkRead=y;this.openTimestamp=0;this._requestList={};this._requestCount=0;var z=t('requestsMarkReadButton');if(z)m.listen(z,'click',this._markRead.shield(this));this.jewel.subscribe('marked-seen',this._markSeenCallback.shield(this));this.jewel.subscribe('closed',this._clearNewItems.shield(this));this.jewel.subscribe('updated',this._updateCount.bind(this));this.jewel.subscribe('opened',this._openHandler.bind(this));o.registerHandler(this._handleLink.bind(this));g.subscribe(j.getArbiterType('jewel_requests_add'),this._addRequest.bind(this));g.subscribe(j.getArbiterType('jewel_requests_remove_old'),this._removeOldRequest.bind(this));g.subscribe(j.getArbiterType('friend_requests_seen'),this._markSeenFromMessage.bind(this));m.listen(this.jewelFlyout,'submit',function(aa){var ba=p.byClass(aa.getTarget(),'objectListItem');if(ba){k.removeClass(ba,'jewelItemNew');k.addClass(ba,'jewelItemResponded');this.pageInCollapsedRequests();}}.bind(this));this.setupScroll();return this;},setupScroll:function(){var w=l.scry(this.jewelFlyout,'.uiScrollableAreaWrap')[0];if(w){this._scrollableWrap=w;this._lastLinkPosition=0;this._scrollListener=m.listen(w,'scroll',this._handleScroll.bind(this),m.Priority._BUBBLE);}},fromDom:function(){l.scry(this.jewelFlyout,'.jewelItemList li.objectListItem').forEach(function(w){var x=w.getAttribute('id');if(x){var y=this._parseIDToInts(x);if(y.requester)this._requestList[y.requester]=x;++this._requestCount;}}.bind(this));this._conditionShowEmptyMessage();},_parseID:function(w){var x=w.match(/^(\d+)_(\d+)/);return (x)?{requester:x[1],type:x[2]}:undefined;},_parseIDToInts:function(w){var x=w?this._parseID(w):undefined,y;if(x&&x.requester){y=parseInt(x.requester,10);if(isNaN(y))y=undefined;}var z;if(x&&x.type){z=parseInt(x.type,10);if(isNaN(z))z=undefined;}return {requester:y,type:z};},_handleLink:function(w,event){var x=p.byClass(w,'jewelItemNew');if(x&&p.byClass(x,'fbRequestList')&&p.byClass(x,'beeperEnabled')){var y=this._parseID(x.id);y&&this._markSeenCallback(y.requester,y.type);g.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});k.removeClass(x,'jewelItemNew');}return true;},_handleScroll:function(){var w=l.scry(this._scrollableWrap,'.uiMorePager');if(!w||(t('fbRequestsJewelManualPager')&&w.length<2))return;var x=w.pop();if(x){var y=r.getElementPosition(x,'viewport').y;if(y>0)k.addClass(p.byClass(this._scrollableWrap,'uiScrollableArea'),'contentAfter');var z=l.find(x,'a');if(!z)return;var aa=r.getElementPosition(z,'viewport').y;if(aa==this._lastLinkPosition)return;var ba=r.getElementPosition(this._scrollableWrap,'viewport').y+r.getElementDimensions(this._scrollableWrap).y;if(aa-300<ba&&aa>0){this._lastLinkPosition=aa;var ca=z.getAttribute('ajaxify');if(ca){new h(ca).setRelativeTo(z).setStatusElement(p.byClass(z,'stat_elem')).send();}else n.getInstance('jewel').showMore();}}},_addRequest:function(w,x){if(!x)return;var y=x.obj.from,z=x.obj.suggester,aa=this._parseIDToInts(this._requestList[y]).type,ba=aa===19&&!z;if(!ba&&(aa||this.jewel.isOpen()))return;if(t('fbRequestsJewelLoading')){new h().setURI('/ajax/requests/loader/').send();}else{var ca=this._onMarkupCallback.bind(this,y,!!z),da={from:y};if(z)da.suggester=z;new h().setURI('/ajax/friends/jewel/request_markup').setData(da).setHandler(ca).send();}},_onMarkupCallback:function(w,x,y){var z=y.getPayload();if(!z)return;var aa=this._requestList[w],ba=this._parseIDToInts(aa).type;if(ba===19&&!x){var ca=aa&&t(aa);ca&&l.replace(ca,z.markup);}else{var da=l.scry(this.jewelFlyout,'.fbRequestList .uiList')[0];if(!da)return;l.prependContent(da,z.markup);var ea={jewel:'requests',count:++this.countNew};g.inform('jewel/count-updated',ea);++this._requestCount;this._conditionShowEmptyMessage();}this._requestList[w]=z.item_id;},_removeOldRequest:function(w,x){if(!x||this.jewel.isOpen()||t('fbRequestsJewelLoading')!==null)return;var y=this._requestList[x.obj.from],z=y&&t(y);if(z){k.hasClass(z,'jewelItemNew')&&g.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});if(!k.hasClass(z,'jewelItemResponded')){l.remove(z);delete this._requestList[x.obj.from];--this._requestCount;this._conditionShowEmptyMessage();}}},pageInCollapsedRequests:function(){var w=t('fbRequestsJewelManualPager');if(w){var x=l.scry(w,'.uiMorePagerPrimary')[0];if(x.style&&x.style.display!='none')setTimeout(function(){x.click();},100);}},_markRead:function(){this.jewel.markSeen();this._clearNewItems();},_markSeenCallback:function(w,x){var y=l.scry(this.jewelFlyout,'li');new i('/ajax/gigaboxx/endpoint/UpdateLastSeenTime.php',{folder:this.folder,first_item:y[0].id}).send();var z=typeof w!='undefined'&&typeof x!='undefined'?{requester:w,type:x}:{};this.doNewMarkRead&&new i('/ajax/requests/mark_read/',z).send();},_markSeenFromMessage:function(w,x){g.inform('jewel/count-updated',{jewel:'requests',count:0});},_removeRequest:function(w,x){var y=x.obj.item_id;if(y){var z=t(y),aa=z&&k.hasClass(z,'jewelItemNew');z?l.remove(z):false;aa&&g.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});}},_clearNewItems:function(w,x){l.scry(this.jewel.root,'li.jewelItemNew').forEach(function(y){k.removeClass(y,'jewelItemNew');});},_updateCount:function(w,x){this.countNew=x.count;k.conditionClass(this.jewelFlyout,'beeperUnread',this.countNew>0);k.conditionClass(this.jewelFlyoutCase,'showRequests',this.countNew>0);if(this.newCountSpan){var y=this.countNew==1?u._("{num} NEW REQUEST",{num:this.countNew}):u._("{num} NEW REQUESTS",{num:this.countNew});l.setContent(this.newCountSpan,y);}},_conditionShowEmptyMessage:function(){l.scry(this.jewelFlyout,'li.empty').forEach(function(w){k.conditionShow(w,this._requestCount<=0);}.bind(this));},_openHandler:function(){var w=l.scry(this.jewelFlyout,'.uiScrollableArea')[0];if(t('fbRequestsJewelLoading')){var x=Date.now();if(this.openTimestamp+5000<x){this.openTimestamp=x;new h().setURI('/ajax/requests/loader/').send();}}w&&q.poke(w);}});e.exports=v;});
__d("legacy:RequestsJewel",["RequestsJewel"],function(a,b,c,d){a.RequestsJewel=b('RequestsJewel');},3);
__d("JewelX",["Event","Arbiter","ArbiterMixin","CSS","DOM","HTML","Keys","TabIsolation","Toggler","copyProperties","emptyFunction","reportData"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('CSS'),k=b('DOM'),l=b('HTML'),m=b('Keys'),n=b('TabIsolation'),o=b('Toggler'),p=b('copyProperties'),q=b('emptyFunction'),r=b('reportData'),s=function(t,u){t&&u&&this.init(t,u);};p(s,{_instancesByName:{},_resizeListener:null});p(s.prototype,i,{init:function(t,u){this.name=u.name;this.root=t;this.countNew=0;this.initialCount=0;this.escHandler=null;s._instancesByName[this.name]=this;var v=k.find(t,'.jewelFlyout'),w=new n(v);o.listen('show',this.root,function(x){this._logFirstClick();this.hasNew()&&this.markSeen();this.reset();this.inform('opened');h.inform('layer_shown',{type:'Jewel'});w.enable();this.setupEvents();}.bind(this));o.listen('hide',this.root,function(x,y){this.hasNew()&&this.markSeen();this.reset();this.inform('closed');h.inform('layer_hidden',{type:'Jewel'});w.disable();this.removeEvents();}.bind(this));h.subscribe('jewel/count-updated',function(x,y){y.jewel==this.name&&this.update(y);}.bind(this));h.subscribe('jewel/count-initial',function(x,y){y.jewel==this.name&&this.setInitial(y);}.bind(this));h.subscribe('jewel/reset',function(x,y){y.jewel==this.name&&this.reset();}.bind(this));s._resizeListener=s._resizeListener||(function(){var x=null;return g.listen(window,'resize',function(){clearTimeout(x);x=h.inform.bind(h,'jewel/resize').defer(100,false);});})();},getRoot:function(){return this.root;},hasNew:function(){return j.hasClass(this.root,'hasNew');},isOpen:function(){return j.hasClass(this.root,'openToggler');},reset:function(){j.removeClass(this.root,'hasNew');},setContent:function(t){var u=k.find(this.root,'ul.jewelItemList');k.setContent(u,l(t));},update:function(t){this.countNew=t.count;var u=k.find(this.root,'span.jewelCount span');k.setContent(u,this.countNew);var v=isNaN(this.countNew)||this.countNew>0;j.conditionClass(this.root,'hasNew',v);if(v){var w=(''+this.countNew).length;j.conditionClass(this.root,'hasCountSmall',w===1);j.conditionClass(this.root,'hasCountMedium',w===2);j.conditionClass(this.root,'hasCountLarge',w>2);}this.inform('updated',t);},setInitial:function(t){this.initialCount=t;},setupEvents:function(){this.escHandler=g.listen(document.documentElement,'keydown',function(t){if(t.keyCode===m.ESC&&this.isOpen())o.hide(this.root);}.bind(this));},removeEvents:function(){if(this.escHandler)this.escHandler.remove();},markSeen:function(){h.inform('jewel/count-updated',{jewel:this.name,count:0},h.BEHAVIOR_STATE);this.inform('marked-seen');},_logFirstClick:function(){this._logFirstClick=q;r('jewel_click',{gt:{count:this.countNew,initial:this.initialCount,jewel:this.name}});}});e.exports=s;});
__d("MercuryJewelCountControl",["Arbiter","MercuryConstants","DOM","MercuryServerRequests","MercuryThreadInformer","MercuryUnseenState","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('MercuryConstants'),i=b('DOM'),j=b('MercuryServerRequests').get(),k=b('MercuryThreadInformer').get(),l=b('MercuryUnseenState').get(),m=b('copyProperties'),n=b('tx'),o,p,q,r=function(t){if(t||q.isOpen())l.markAsSeen();},s=function(t,u){o=t;p=i.find(o,'#mercurymessagesCountValue');q=u;this.render();j.subscribe('model-update-completed',function(v,w){r(false);});k.subscribe('unseen-updated',this.render.bind(this));q.subscribe('marked-seen',r.shield(this,true));};m(s.prototype,{render:function(){var t='';if(l.exceedsMaxCount()){t=n._("{count}+",{count:h.MercuryThreadlistConstants.MAX_UNSEEN_COUNT});}else t=l.getUnseenCount().toString();g.inform('jewel/count-updated',{jewel:'mercurymessages',count:t},g.BEHAVIOR_STATE);}});e.exports=s;});
__d("MercuryJewelThreadlistControl",["Arbiter","ArbiterMixin","MercuryChatUtils","MercuryConfig","MercuryConstants","CSS","DOM","Event","JSLogger","MercuryOrderedThreadlist","Parent","MercuryJewelTemplates","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads","MercuryUnreadState","copyProperties","csx","cx","throttle","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('MercuryChatUtils'),j=b('MercuryConfig'),k=b('MercuryConstants'),l=b('CSS'),m=b('DOM'),n=b('Event'),o=b('JSLogger'),p=b('MercuryOrderedThreadlist').get(),q=b('Parent'),r=b('MercuryJewelTemplates'),s=b('MercuryThreadInformer').get(),t=b('MercuryThreadMetadataRenderer').get(),u=b('MercuryThreads').get(),v=b('MercuryUnreadState').get(),w=b('copyProperties'),x=b('csx'),y=b('cx'),z=b('throttle'),aa=b('tx'),ba=o.create('mercury_jewel');function ca(ja,ka){this._contentArea=m.scry(ja,'.scrollable')[0]||ja;this._contentElement=m.find(this._contentArea,'.jewelContent');this._loadingElement=m.find(this._contentArea,'.jewelLoading');this._uiList=m.find(this._contentArea,'.jewelItemList');this._loadMoreButton=m.find(this._contentArea,"._8y5");this._loadMoreLink=m.find(this._contentArea,"a._8y6");this._currentFolder=k.MessagingTag.INBOX;if(j.OtherFolderJewelGK){this._jewelFolderLinks=[];this._jewelFolderLinks[k.MessagingTag.INBOX]=m.find(ka,"._1sde");this._jewelFolderLinks[k.MessagingTag.OTHER]=m.find(ka,"._1sdf");this._jewelFolderCounts=[];this._jewelFolderCounts[k.MessagingTag.INBOX]=m.find(ka,"._1sdg");this._jewelFolderCounts[k.MessagingTag.OTHER]=m.find(ka,"._1sdh");ha.bind(this)();n.listen(this._jewelFolderLinks[k.MessagingTag.INBOX],'click',ga.bind(this,k.MessagingTag.INBOX));n.listen(this._jewelFolderLinks[k.MessagingTag.OTHER],'click',ga.bind(this,k.MessagingTag.OTHER));}this._curCount=[];this._curCount[k.MessagingTag.INBOX]=k.MercuryThreadlistConstants.JEWEL_THREAD_COUNT+1;this._curCount[k.MessagingTag.OTHER]=k.MercuryThreadlistConstants.JEWEL_THREAD_COUNT+1;this._isFolderLoaded=[];this._isFolderLoaded[k.MessagingTag.INBOX]=false;this._isFolderLoaded[k.MessagingTag.OTHER]=false;this._folderIsLoading=[];this._folderIsLoading[k.MessagingTag.INBOX]=false;this._folderIsLoading[k.MessagingTag.OTHER]=false;s.subscribe('threadlist-updated',this.render.bind(this));if(j.OtherFolderJewelGK)s.subscribe('unread-updated',ha.bind(this));this.render();ba.bump('opened_threadlist_'+this._currentFolder);n.listen(this._contentArea,'scroll',z(da,50,this));n.listen(this._loadMoreLink,'click',this.renderMoreThreads.bind(this));}w(ca,{EVENT_THREADS_LOADED:'threads-loaded',EVENT_THREADS_RENDERED:'threads-rendered'});w(ca.prototype,h);w(ca.prototype,{render:function(){m.empty(this._contentElement);l.show(this._loadingElement);l.hide(this._loadMoreButton);var ja=m.create('div');m.appendContent(this._contentElement,ja);p.getThreadlist(k.MercuryThreadlistConstants.RECENT_THREAD_OFFSET,this._curCount[this._currentFolder],this._currentFolder,this.renderThreads.bind(this,ja),true);},renderThreads:function(ja,ka){this.inform(ca.EVENT_THREADS_LOADED);if(ka.length){ka.forEach(function(la){var ma=r[':fb:mercury:jewel:threadlist-row'].build();u.getThreadMeta(la,function(na){t.renderCoreThreadlist(na,ma,this.renderSingleThread.bind(this),{show_unread_count:true});}.bind(this));m.appendContent(ja,ma.getRoot());}.bind(this));}else m.setContent(this._uiList,this.renderEmptyThreadlist());l.hide(this._loadingElement);l.conditionShow(this._loadMoreButton,!this._isFolderLoaded[this._currentFolder]);this.inform(ca.EVENT_THREADS_RENDERED);},renderSingleThread:function(ja,ka){if(ka.unread_count>0)l.addClass(ja.getRoot(),'jewelItemNew');if(j.MessagesJewelOpenInChat&&i.canOpenChatTab(ka)){n.listen(ja.getRoot(),'click',function(event){g.inform('chat/open-tab',{thread_id:ka.thread_id});});}else t.renderTitanLink(ka.thread_id,ja.getNode('link'),null,this._currentFolder);n.listen(ja.getRoot(),'mouseover',function(event){var la=ja.getRoot();if(!q.byClass(la,'notifNegativeBase'))l.addClass(la,'selected');});n.listen(ja.getRoot(),'mouseout',function(event){l.removeClass(ja.getRoot(),'selected');});},renderMoreThreads:function(){l.addClass(this._loadMoreButton,'async_saving');this._folderIsLoading[this._currentFolder]=true;var ja=this._curCount[this._currentFolder]+k.MercuryThreadlistConstants.JEWEL_MORE_COUNT;p.getThreadlist(k.MercuryThreadlistConstants.RECENT_THREAD_OFFSET,ja+1,this._currentFolder,fa.bind(this,ja,this._currentFolder),true,k.MercuryAPIArgsSource.JEWEL);},renderEmptyThreadlist:function(){return m.create('li',{className:'empty'},"No messages");}});function da(){if(!this._isFolderLoaded[this._currentFolder]&&!this._folderIsLoading[this._currentFolder]&&ea.bind(this)())this.renderMoreThreads();}function ea(){return this._contentArea.scrollTop+this._contentArea.clientHeight>=this._contentArea.scrollHeight-1;}function fa(ja,ka,la){this._curCount[ka]=ja;if(!this._isFolderLoaded[ka]&&la.length<this._curCount[ka]+1)this._isFolderLoaded[ka]=true;this._folderIsLoading[ka]=false;l.removeClass(this._loadMoreButton,'async_saving');this.render();}function ga(ja){if(this._currentFolder!=ja){ba.bump('opened_threadlist_'+ja);l.addClass(this._jewelFolderLinks[ja],"_1sdd");l.removeClass(this._jewelFolderLinks[this._currentFolder],"_1sdd");this._currentFolder=ja;this.render();}}function ha(){ia.bind(this)(k.MessagingTag.INBOX);ia.bind(this)(k.MessagingTag.OTHER);}function ia(ja){var ka;if(v.exceedsMaxCount(ja)){ka=k.MercuryThreadlistConstants.MAX_UNREAD_COUNT;}else ka=v.getUnreadCount(ja);var la=this._jewelFolderCounts[ja];if(ka>0){if(ka==k.MercuryThreadlistConstants.MAX_UNREAD_COUNT)ka+='+';m.setContent(la,aa._("({unread_count})",{unread_count:ka}));}else m.setContent(la,'');}e.exports=ca;});
__d("MercuryJewel",["MercuryChannelHandler","MercuryJewelCountControl","DOM","MercuryJewelThreadlistControl","MercuryServerRequests","userAction"],function(a,b,c,d,e,f){b('MercuryChannelHandler');var g=b('MercuryJewelCountControl'),h=b('DOM'),i=b('MercuryJewelThreadlistControl'),j=b('MercuryServerRequests').get(),k=b('userAction'),l=false;function m(q,r,s,t){j.handleUpdate(t);var u=new g(r,s),v=h.find(q,'#MercuryJewelThreadList');if(s.getRoot()&&s.isOpen()){n.call(this,v,q);}else s.subscribe('opened',n.bind(this,v,q));}e.exports=m;function n(q,r){this._ua=k('messages').uai('click','jewel');this._listenForLoad=this._listenForRender=true;if(!l){var s=new i(q,r);s.subscribe(i.EVENT_THREADS_LOADED,o.bind(this));s.subscribe(i.EVENT_THREADS_RENDERED,p.bind(this));l=true;}}function o(){if(this._listenForLoad){this._ua.add_event('loaded');this._listenForLoad=false;}}function p(){if(this._listenForRender){this._ua.add_event('rendered');this._listenForRender=false;}}});
__d("MessagingEvents",["array-extensions","Arbiter","ChannelConstants","copyProperties","isEmpty"],function(a,b,c,d,e,f){b('array-extensions');var g=b('Arbiter'),h=b('ChannelConstants'),i=b('copyProperties'),j=b('isEmpty'),k={},l=new g();function m(n){if(!j(k))return;for(var o in n)l.inform('count/'+o,n[o]);}l.subscribe('mark-as-read',function(n,o){(o.tids||o.chat_ids||[]).forEach(function(p){p=''+p;if(!(p in k)){k[p]=true;var q=function(){l.unsubscribe(r);clearTimeout(s);delete k[p];},r=l.subscribe('read',function(t,u){if((u.tids||[]).contains(p)||(u.chat_ids||[]).contains(p))q();}),s=q.defer(60000);}});});g.subscribe(h.getArbiterType('messaging'),function(n,o){var p=i({},o.obj),event=p.event||'';delete p.type;delete p.event;l.inform(event,p);if('unread_counts' in p){var q=p.unread_counts;m({unread:q.inbox,other_unseen:q.other});}});g.subscribe(h.getArbiterType('inbox'),function(n,o){var p=i(o.obj);delete p.type;m(p);});a.MessagingEvents=e.exports=l;},3);
__d("TitanLeftNav",["CounterDisplay","MessagingEvents"],function(a,b,c,d,e,f){var g=b('CounterDisplay'),h=b('MessagingEvents'),i={initialize:function(){h.subscribe('count/other_unseen',function(j,k){g.setCount('other_unseen',k);});}};e.exports=i;});
__d("AccessibleMenu",["Event","CSS","DOM","Keys","TabbableElements","Toggler"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('Keys'),k=b('TabbableElements'),l=b('Toggler'),m,n,o;function p(){var x=i.scry(m,'a[rel="toggle"]')[0];x&&x.focus();l.getInstance(m).hide();}function q(x){if(!x)return false;h.removeClass(x,'selected');x.setAttribute('aria-selected','false');}function r(x){if(!x)return false;h.addClass(x,'selected');x.setAttribute('aria-selected','true');var y=k.find(x);if(y[0])y[0].focus();}function s(x){var y=i.scry(m,'.selected')[0],z=n.indexOf(y)+x,aa=n[z];if(!aa)return false;q(y);r(aa);}function t(x){if(!l.isShown()||l.getActive()!==m)return true;var y=g.getKeyCode(x);switch(y){case j.TAB:s(x.shiftKey?-1:1);g.prevent(x);break;case j.ESC:p();g.prevent(x);break;case j.UP:case j.DOWN:s(y===j.UP?-1:1);g.prevent(x);break;}}function u(x,y){m=y.getActive();n=i.scry(m,'[role="menuitem"]');if(!o)o=g.listen(document.documentElement,'keydown',t);}function v(){if(l.getActive()==m)q(i.scry(m,'.selected')[0]);}var w={init:function(x){l.listen('show',x,u);l.listen('hide',x,v);}};e.exports=w;});
__d("DoublyLinkedListMap",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(){this._head=null;this._tail=null;this._nodes={};this._nodeCount=0;}g(h.prototype,{get:function(i){return this._nodes[i]?this._nodes[i].data:null;},_insert:function(i,j,k,l){k&&!this._nodes[k]&&(k=null);var m=(k&&this._nodes[k])||(l?this._head:this._tail),n={data:j,key:i,next:null,prev:null};if(m){this.remove(i);if(l){n.prev=m.prev;m.prev&&(m.prev.next=n);m.prev=n;n.next=m;}else{n.next=m.next;m.next&&(m.next.prev=n);m.next=n;n.prev=m;}}n.prev===null&&(this._head=n);n.next===null&&(this._tail=n);this._nodes[i]=n;this._nodeCount++;return this;},insertBefore:function(i,j,k){return this._insert(i,j,k,true);},insertAfter:function(i,j,k){return this._insert(i,j,k,false);},prepend:function(i,j){return this.insertBefore(i,j,this._head&&this._head.key);},append:function(i,j){return this.insertAfter(i,j,this._tail&&this._tail.key);},remove:function(i){var j=this._nodes[i];if(j){var k=j.next,l=j.prev;k&&(k.prev=l);l&&(l.next=k);this._head===j&&(this._head=k);this._tail===j&&(this._tail=l);delete this._nodes[i];this._nodeCount--;}return this;},find:function(i){for(var j=this._head;j;j=j.next)if(i(j.data))return j.key;return null;},reduce:function(i,j){for(var k=this._head;k;k=k.next)j=i(k.data,j);return j;},exists:function(i){return !!this._nodes[i];},isEmpty:function(){return !this._head;},reset:function(){this._head=null;this._tail=null;this._nodes={};this._nodeCount=0;},map:function(i){for(var j=this._head;j;j=j.next)i(j.data);},getCount:function(){return this._nodeCount;},getHead:function(){return this._head&&this._head.data;},getTail:function(){return this._tail&&this._tail.data;},getNext:function(i){var j=this._nodes[i];if(j&&j.next)return j.next.data;return null;},getPrev:function(i){var j=this._nodes[i];if(j&&j.prev)return j.prev.data;return null;}});e.exports=h;});
__d("UserNoOp",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=function(){},i=function(){return this;};g(h.prototype,{add_event:i,add_data:i,uai:i,uai_fallback:i});e.exports=h;});
__d("NegativeNotif",["Animation","AsyncRequest","CSS","DataStore","DOM","Event","Parent","Tooltip","NotifXList","$","clickRefAction","copyProperties","userAction"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('AsyncRequest'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('Event'),m=b('Parent'),n=b('Tooltip'),o=b('NotifXList'),p=b('$'),q=b('clickRefAction'),r=b('copyProperties'),s=b('userAction');function t(u,v){r(this,v);this.owner=u;this.xLink=k.find(this.obj,'.notif_x');this.confirmingMsg=k.find(this.obj,'.confirmingMsg');this.mainLink=k.find(this.obj,'.notifMainLink');this.userXClicked=false;this.userUnsubscribed=false;l.listen(this.xLink,'click',this.xClick.bind(this));if(i.hasClass(this.obj,'first_receipt')&&i.hasClass(p('jewelContainer'),'notifGentleAppReceipt'))this.gentleFirstReceiptHoverEventHandler=l.listen(this.obj,'mouseover',this.gentleFirstReceiptNotifHover.bind(this));}r(t.prototype,{FADE_AWAY_DURATION:2500,X_OUT_DURATION:100,X_OUT_DURATION_SHORT:2,GENTLE_FRUI_MIN_HOVER_DURATION:500,GENTLE_FRUI_FADE_DURATION_FAST:200,GENTLE_FRUI_FADE_DURATION_SLOW:2500,GENTLE_FRUI_DELAY_FADE_TIME:60000,xClick:function(event){this._activateX();var u=this.xLink.getAttribute('data-gt'),v=u?{gt:JSON.parse(u)}:{};s('xbutton',this.xLink,event).uai('click');q('click',this.xLink,event,null,v);return false;},gentleFirstReceiptNotifHover:function(event){event.stop();var u=k.find(this.obj,'.first_receipt_no_button'),v=j.get(u,'notif_fr_prompt');n.set(u,v,'above','center');n.show(u);this._gentleFirstReceiptTooltipFadeIn();if(!this.gentleFirstReceiptUnhoverEventHandler){this.hoverTime=new Date();this.gentleFirstReceiptUnhoverEventHandler=l.listen(document.documentElement,'mouseover',this.gentleFirstReceiptNotifUnhover.bind(this));}if(!this.gentleFirstReceiptNoClickEventHandler)this.gentleFirstReceiptNoClickEventHandler=l.listen(u,'click',this.gentleFirstReceiptNoClick.bind(this));},gentleFirstReceiptNotifUnhover:function(event){if(m.byClass(event.getTarget(),'uiContextualLayer')||m.byClass(event.getTarget(),'uiScrollableAreaTrack'))return false;var u=new Date();if(this.hoverTime&&u-this.hoverTime<this.GENTLE_FRUI_MIN_HOVER_DURATION){this.gentleFirstReceiptUnhoverEventHandler.remove();this.gentleFirstReceiptUnhoverEventHandler=null;this._gentleFirstReceiptTooltipAlreadyFadedIn=false;return;}this._removeGentleFirstReceiptListeners();this._gentleFirstReceiptTooltipFadeAway();this._gentleFirstReceiptXButtonFadeAway();var v=this;setTimeout(function(){v._gentleFirstReceiptUIFadeAway();},this.GENTLE_FRUI_DELAY_FADE_TIME);this._sendFirstReceiptYesToServer();},gentleFirstReceiptNoClick:function(event){this._removeGentleFirstReceiptListeners();},restore:function(){if(o.newNotifExist(this.id)){o.resumeInsert(this.id);}else o.removeNotif(this.id);this._confirmingMsgFadeAway(this.confirmingMsg);this._notifMainLinkShowUp(this.mainLink);this._buttonShowUp(this.xLink);this._adjustContainer(this.obj);},reset:function(){if(this.userXClicked&&!this.userUnsubscribed){this.userXClicked=false;this.restore();}},onTurnedOff:function(){this.userUnsubscribed=true;i.hide(this.confirmingMsg);this._notifMainLinkShowUp(k.find(this.obj,'.confirmedMsg'));this._adjustContainer(this.obj);},onUndid:function(){this.userXClicked=false;this.userUnsubscribed=false;this.restore();i.show(this.confirmingMsg);this._notifMainLinkFadeAway(k.find(this.obj,'.confirmedMsg'));k.remove(k.find(this.obj,'.confirmedMsg'));},onMarkedSpam:function(){k.remove(k.find(this.obj,'.confirmedMsg'));this._fadeAway(k.find(this.obj,'.spamMsg'));},onFirstReceiptYes:function(){this._hideFirstReceiptDiv();this._fadeAway(k.find(this.obj,'.firstConfirmedMsg'));},onFirstReceiptNo:function(){this._hideFirstReceiptDiv();i.hide(this.confirmingMsg);this._activateX();new h().setURI('/ajax/notifications/negative_req.php').setData({request_type:'turn_off',notification_id:this.id}).send();},_sendFirstReceiptYesToServer:function(){new h().setURI('/ajax/notifications/negative_req.php').setData({request_type:'first_receipt_yes',notification_id:this.id}).send();},_gentleFirstReceiptTooltipFadeIn:function(){if(this._gentleFirstReceiptTooltipAlreadyFadedIn)return;var u=k.find(document.documentElement,'.uiLayer .uiContextualLayer .uiTooltipX');new g(u).from('opacity','0').to('opacity','1').duration(this.GENTLE_FRUI_FADE_DURATION_FAST).go();this._gentleFirstReceiptTooltipAlreadyFadedIn=true;},_gentleFirstReceiptTooltipFadeAway:function(){if(!this._gentleFirstReceiptTooltipAlreadyFadedIn)return;var u=k.find(document.documentElement,'.uiLayer .uiContextualLayer .uiTooltipX'),v=m.byClass(u,'uiLayer'),w=v.cloneNode(true);k.insertAfter(v,w);new g(w).from('opacity','1').to('opacity','0').duration(this.GENTLE_FRUI_FADE_DURATION_FAST).ondone(function(){k.remove(w);}).go();this._gentleFirstReceiptTooltipAlreadyFadedIn=false;},_gentleFirstReceiptXButtonFadeAway:function(){var u=k.find(this.obj,'.first_receipt_no_button');new g(u).from('opacity','1').to('opacity','0').duration(this.GENTLE_FRUI_FADE_DURATION_FAST).hide().go();i.addClass(this.obj,'show_original_x');},_gentleFirstReceiptUIFadeAway:function(){var u=this.obj;this.new_label=k.find(this.obj,'.notif_new_label');new g(this.new_label).to('opacity','0').duration(this.GENTLE_FRUI_FADE_DURATION_SLOW).ondone(function(){i.removeClass(u,'first_receipt');}).go();if(!i.hasClass(this.obj,'jewelItemNew'))new g(this.obj).from('backgroundColor','#ECEFF5').to('backgroundColor','#FFFFFF').duration(this.GENTLE_FRUI_FADE_DURATION_SLOW).go();},_removeGentleFirstReceiptListeners:function(){if(this.gentleFirstReceiptHoverEventHandler)this.gentleFirstReceiptHoverEventHandler.remove();if(this.gentleFirstReceiptUnhoverEventHandler)this.gentleFirstReceiptUnhoverEventHandler.remove();if(this.gentleFirstReceiptNoClickEventHandler)this.gentleFirstReceiptNoClickEventHandler.remove();},_activateX:function(){i.addClass(this.obj,'forPushSafety');this.userXClicked=true;o.userXClick(this.id);this._notifMainLinkFadeAway(this.mainLink);this._buttonFadeAway(this.xLink);if(i.shown(this.confirmingMsg))this._confirmingMsgShowUp(this.confirmingMsg);this._adjustContainer(this.obj);},_hideFirstReceiptDiv:function(){i.removeClass(this.obj,'first_receipt');i.hide(k.find(this.obj,'.first_receipt_div'));},_fadeAway:function(u){new g(u).from('backgroundColor','#FFF9D7').to('backgroundColor','#FFFFFF').duration(this.FADE_AWAY_DURATION).checkpoint().to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().hide().duration(this.X_OUT_DURATION).go();},_adjustContainer:function(u){new g(u).by('height','0px').duration(this.X_OUT_DURATION).checkpoint().by('height','0px').duration(this.X_OUT_DURATION_SHORT).checkpoint().to('height','auto').duration(this.X_OUT_DURATION).go();},_notifMainLinkShowUp:function(u){new g(u).duration(this.X_OUT_DURATION).checkpoint().to('height','auto').to('paddingTop','4px').to('paddingBottom','4px').blind().show().duration(this.X_OUT_DURATION_SHORT).checkpoint().to('opacity','1').blind().duration(this.X_OUT_DURATION).go();},_confirmingMsgShowUp:function(u){new g(u).duration(this.X_OUT_DURATION).checkpoint().to('height','auto').to('paddingTop','10px').to('paddingBottom','10px').blind().show().duration(this.X_OUT_DURATION_SHORT).checkpoint().to('opacity','1').blind().duration(this.X_OUT_DURATION).go();},_notifMainLinkFadeAway:function(u){new g(u).to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().hide().duration(this.X_OUT_DURATION_SHORT).go();},_confirmingMsgFadeAway:function(u){new g(u).to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().duration(this.X_OUT_DURATION_SHORT).go();},_buttonShowUp:function(u){new g(u).duration(this.X_OUT_DURATION).checkpoint().show().duration(this.X_OUT_DURATION_SHORT).checkpoint().to('opacity','1').blind().duration(this.X_OUT_DURATION).go();},_buttonFadeAway:function(u){new g(u).to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().hide().duration(this.X_OUT_DURATION_SHORT).go();}});e.exports=t;});
__d("NotificationCounter",["Arbiter","DocumentTitle","JSLogger"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DocumentTitle'),i=b('JSLogger'),j={messages:0,notifications:0,requests:0},k={init:function(){g.subscribe('update_title',this._handleUpdate.bind(this));g.subscribe('jewel/count-updated',this._handleCountUpdate.bind(this));},getCount:function(){var l=0;for(var m in j){var n=Number(j[m]);if(typeof j[m]=='string'&&isNaN(n))return j[m];if(isNaN(n)||n<0){i.create('jewels').error('bad_count',{jewel:m,count:j[m]});continue;}l+=n;}return l;},updateTitle:function(){var l=this.getCount(),m=h.get();m=l?'('+l+') '+m:m;h.set(m,true);},_handleCountUpdate:function(l,m){j[m.jewel]=m.count;this.updateTitle();},_handleUpdate:function(l,m){this.updateTitle();}};e.exports=k;});
__d("NotificationList",["Animation","ArbiterMixin","CSS","DOM","DoublyLinkedListMap","HTML","NotificationURI","$","copyProperties","ge","isEmpty","tx","hasArrayNature"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('ArbiterMixin'),i=b('CSS'),j=b('DOM'),k=b('DoublyLinkedListMap'),l=b('HTML'),m=b('NotificationURI'),n=b('$'),o=b('copyProperties'),p=b('ge'),q=b('isEmpty'),r=b('tx'),s=b('hasArrayNature'),t="0",u="1",v="2";function w(z){return z==u||z==v;}function x(z){return z==u;}function y(z,aa){this._list=new k();this._filter_func=null;this.unseenCount=0;this.contentRoot=z;this.noItemsElement=null;this.ITEM_TAG='li';this.ITEM_CLASS='notification';this.NO_ITEMS_ID='jewelNoNotifications';this.NO_ITEMS_CLASS='empty';this.compare=aa.compare||this.compare;this.shouldBlockAnimation=aa.shouldBlockAnimation||null;this.unseenVsUnread=aa.unseenVsUnread||false;this.animations={};}o(y,{ITEM_UNREAD_CLASS:'jewelItemNew',MARK_READ_TYPE:'mark_read',UNREAD_COUNT_CHANGE_TYPE:'unread_count_change',INSERTION_TYPE:'insert',REMOVAL_TYPE:'remove',getIdFromDom:function(z){return z.getAttribute('id').replace('notification_','');},localizeUrls:function(z){j.scry(z,'a').forEach(function(aa){aa.href=m.localize(aa.href);});}});o(y.prototype,h,{FADE_DURATION:250,RESIZE_DURATION:200,_getField:function(z,aa){var ba=this._list.get(z);return ba&&ba[aa];},getDomObj:function(z){return this._getField(z,'obj');},fromDom:function(){var z=this.ITEM_TAG+'.'+this.ITEM_CLASS,aa=j.scry(this.contentRoot,z);for(var ba=0;ba<aa.length;++ba){var ca=aa[ba],da=y.getIdFromDom(ca);this.insert(da,ca.getAttribute('data-notiftime'),null);}},compare:function(z,aa){return z.time<aa.time||(z.time===aa.time&&z.id<aa.id);},insert:function(z,aa,ba,ca,da,ea){var fa=u,ga=0,ha=this._list.exists(z),ia=ea&&this._list.exists(ea),ja=null,ka;if(ha||ia)if(!(ca&&ba)){return false;}else{if(this._filter_func){ka={notif_id:z,notif_time:aa,notif_markup:ba,replace:ca,ignoreUnread:da,notif_alt_id:ea};if(this._filter_func(ka))return false;}fa=this._getField(z,'readness');ga=this._getField(z,'time');if(ga>aa)return false;ja=ha?z:ea;this._remove(ja);}var la=(ba&&l(ba).getRootNode())||n('notification_'+z),ma=Math.max(aa,ga),na=la.getAttribute('data-readness');if(!this.unseenVsUnread&&v==na)na=t;ka={id:z,obj:la,time:ma,readness:na,app_id:la.getAttribute('data-appid')};this._insert(ka);y.localizeUrls(la);this.noItemsElement&&i.hide(this.noItemsElement);if(x(na)){da&&!w(fa)&&this.markRead([z]);this.unseenCount=this.getUnseenIds().length;this.inform(y.UNREAD_COUNT_CHANGE_TYPE);}var oa=!ja||ga<ma||(na&&!fa&&!da);this.inform(y.INSERTION_TYPE,{id:z,is_new:oa,obj:la,replaced_id:ja,time:ma});return true;},showNoNotifications:function(){if(null==this.noItemsElement)this.noItemsElement=p(this.NO_ITEMS_ID);if(null==this.noItemsElement){this.noItemsElement=j.create(this.ITEM_TAG,{id:this.NO_ITEMS_ID,className:this.NO_ITEMS_CLASS},"No new notifications");j.appendContent(this.contentRoot,this.noItemsElement);}i.show(this.noItemsElement);},_insert:function(z){this._list.remove(z.id);var aa=null;this._list.find(function(ca){var da=this.compare(ca,z);!da&&(aa=ca.id);return da;}.bind(this));var ba=this.getDomObj(aa);if(ba){this._list.insertAfter(z.id,z,aa);j.insertAfter(ba,z.obj);}else{this._list.prepend(z.id,z);j.prependContent(this.contentRoot,z.obj);}},_remove:function(z){var aa=this._getField(z,'obj');if(!aa)return false;this.inform(y.REMOVAL_TYPE,{id:z});this._list.remove(z);j.remove(aa);this.isEmpty()&&this.showNoNotifications();return true;},getUnreadIds:function(){return this._list.reduce(function(z,aa){w(z.readness)&&aa.push(z.id);return aa;},[]);},getUnseenIds:function(){return this._list.reduce(function(z,aa){x(z.readness)&&aa.push(z.id);return aa;},[]);},getIds:function(){return this._list.reduce(function(z,aa){aa.push(z.id);return aa;},[]);},isUnreadId:function(z){var aa=this.getDomObj(z);return w(this._getField(z,'readness'))||(aa&&i.hasClass(aa,y.ITEM_UNREAD_CLASS));},isUnseenId:function(z){return x(this._getField(z,'readness'));},markRead:function(z,aa){z=z?z.filter(this.isUnreadId.bind(this)):this.getUnreadIds();var ba=false;for(var ca=0;ca<z.length;ca++){var da=this._list.get(z[ca]);if(da){if(this._setReadness(z[ca],t))ba=true;if(aa){this._markReadInDom(z[ca],da.obj);}else this.animateMarkRead(da.obj);}}if(ba){this.unseenCount=this.getUnseenIds().length;this.inform(y.UNREAD_COUNT_CHANGE_TYPE);}},markSeen:function(z){if(!s(z))return;if(!this.unseenVsUnread){this.markRead(z);return;}z=z.filter(this.isUnseenId.bind(this));var aa=false;for(var ba=0;ba<z.length;ba++)if(this._setReadness(z[ba],v))aa=true;if(aa){this.unseenCount=this.getUnseenIds().length;this.inform(y.UNREAD_COUNT_CHANGE_TYPE);}},_setReadness:function(z,aa){var ba=this._list.get(z);if(!ba||ba.readness==aa)return false;if(ba.readness==t&&aa==v)return false;ba.readness=aa;ba.obj.setAttribute('data-readness',aa);return true;},_markReadInDom:function(z,aa){if(!this.isUnreadId(z))return;var ba=n(aa);if(ba){this.stopAnimation(z);i.removeClass(ba,y.ITEM_UNREAD_CLASS);}},animateMarkRead:function(z){if(!i.hasClass(z,y.ITEM_UNREAD_CLASS))return;var aa=y.getIdFromDom(z),ba=this._markReadInDom.bind(this,aa,z);if(i.hasClass(z,'fbJewelBeep')){ba();return;}if(this.shouldBlockAnimation&&this.shouldBlockAnimation(z))return;ba.defer(10000);},stopAnimation:function(z){z in this.animations&&this.animations[z].stop();delete this.animations[z];return true;},insertMany:function(z,aa){if('object'==typeof z&&!q(z)){for(var ba in z){var ca=z[ba];this.insert(ba,ca.time,ca.markup,true,aa,ca.alt_id||null);}this.noItemsElement&&i.hide(this.noItemsElement);}else this.isEmpty()&&this.showNoNotifications();},isEmpty:function(){return this._list.isEmpty();},getEarliestNotifTime:function(){return this._list.isEmpty()?0:Math.min.apply(null,this.getIds().map(function(z){return this._getField(z,'time');}.bind(this)));},setFilterFn:function(z){this._filter_func=z;},toggleNotifsSimilarTo:function(z,aa,ba){var ca=this._getField(z,'app_id');if(ca){var da=this.getIds();for(var ea=0;ea<da.length;++ea)if(ca==this._getField(da[ea],'app_id')){var fa=this.getDomObj(da[ea]);if(z!=da[ea])aa?this._hideWithAnimation(fa):this._showWithAnimation(fa);var ga=j.scry(fa,'.first_receipt_div');if(ga.length==1)if(ba){i.hide(ga[0]);i.removeClass(fa,'first_receipt');}else{i.show(ga[0]);i.addClass(fa,'first_receipt');}}}},_hideWithAnimation:function(z){g(z).to('opacity','0').blind().duration(this.FADE_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().hide().duration(this.RESIZE_DURATION).go();},_showWithAnimation:function(z){g(z).to('height','auto').to('paddingTop','auto').to('paddingBottom','auto').blind().show().duration(this.RESIZE_DURATION).checkpoint().to('opacity','1').blind().duration(this.FADE_DURATION).go();}});e.exports=y;});
__d("Notifications",["Animation","Arbiter","AsyncRequest","AsyncSignal","Bootloader","ChannelConstants","CSS","DOM","Env","Event","JSLogger","NegativeNotif","NotificationCounter","NotificationList","NotifXList","Parent","Poller","ScrollableArea","Style","SystemEvents","Toggler","URI","UserActivity","UserNoOp","Vector","$","copyProperties","emptyFunction","ge","hasArrayNature","isEmpty","throttle","userAction"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('AsyncSignal'),k=b('Bootloader'),l=b('ChannelConstants'),m=b('CSS'),n=b('DOM'),o=b('Env'),p=b('Event'),q=b('JSLogger'),r=b('NegativeNotif'),s=b('NotificationCounter'),t=b('NotificationList'),u=b('NotifXList'),v=b('Parent'),w=b('Poller'),x=b('ScrollableArea'),y=b('Style'),z=b('SystemEvents'),aa=b('Toggler'),ba=b('URI'),ca=b('UserActivity'),da=b('UserNoOp'),ea=b('Vector'),fa=b('$'),ga=b('copyProperties'),ha=b('emptyFunction'),ia=b('ge'),ja=b('hasArrayNature'),ka=b('isEmpty'),la=b('throttle'),ma=b('userAction');function na(oa){this.updateTime=oa.updateTime||Date.now();this.update_period=oa.updatePeriod||60000;this.latest_notif_time=oa.latestNotif||0;this.latest_read_notif_time=oa.latestReadNotif||0;this.cache_version=oa.cacheVersion||0;this.notifReceivedType=oa.notifReceivedType||'notification';this.wrapperID=oa.wrapperID||'notificationsWrapper';this.contentID=oa.contentID||'jewelNotifs';this.shouldLogImpressions=oa.shouldLogImpressions||false;this.allowDesktopNotifications=oa.allowDesktopNotifications||false;this.logAutoShutOffImpression=true;this.useInfiniteScroll=oa.useInfiniteScroll||false;this.unseenVsUnread=oa.unseenVsUnread||false;this.scrollableAreaNode=null;this.firstReceiptMap={};this.user=o.user;this.queuedNotifications=[];this.timeElement='small.time';this.ua=new da();this._init();}ga(na.prototype,{TIME_TRAVEL:'time_travel',ONLINE:'online',SCROLL_OFF_TINY:'scroll_off_tiny',INACTIVE_REFRESH:'inactive_refresh',_init:function(){this.cookieName='notifications_'+this.user;this.updateCheckCount=0;this.fetchListeners=[];this.currentFetchRequest=null;this.wrapper=ia(this.wrapperID);this.content=ia(this.contentID);this.jewelFlyout=ia('fbNotificationsFlyout');this.footer=n.find(this.jewelFlyout,'.jewelFooter');this.loadingIndicator=ia(this.contentID+'_loading_indicator');this.NOTIF_JEWEL_REF='notif_jewel';this.notifLogger=q.create('notifications');s.init();this.alertList=new t(this.content,this._getListParams());this._updateCount();a.MinNotifications&&a.MinNotifications.fetchSent()&&(this.fetch=ha);h.subscribe(l.getArbiterType(this.notifReceivedType),this._handleNotificationMsg.bind(this));h.subscribe(l.getArbiterType('notifications_read'),this._handleNotificationsReadMsg.bind(this));h.subscribe(l.getArbiterType('notifications_seen'),this._handleNotificationsSeenMsg.bind(this));h.subscribe('jewel/resize',this._hideOverflow.shield(this));this.alertList.subscribe(t.UNREAD_COUNT_CHANGE_TYPE,this._updateCount.bind(this));this._poller=new w({interval:this.update_period,setupRequest:this._update.bind(this),clearOnQuicklingEvents:false});if(this.wrapper)this.countSpan=n.find(this.wrapper,'span.jewelCount span');this.initializeEvents();this.fromDom();if(this.useInfiniteScroll){this._autoLoadNotifIndex=1;this._truncate=false;this.alertList.subscribe(t.INSERTION_TYPE,this._handleInsert.bind(this));}},_getListParams:function(){return {shouldBlockAnimation:function(oa){return this.isNotifJewelOpen();}.bind(this),unseenVsUnread:this.unseenVsUnread};},fromDom:function(){this.alertList.fromDom();a.MinNotifications&&a.MinNotifications.fetched()&&this.alertList.isEmpty()&&this.alertList.showNoNotifications();},initializeEvents:function(){var oa=this.alertList.ITEM_TAG,pa=null;p.listen(this.content,{mouseover:function(event){var sa=event.getTarget();pa=v.byTag(sa,oa);if(pa&&sa!=pa)if(v.byClass(pa,'notifNegativeBase')){m.addClass(pa,'notifHover');}else m.addClass(pa,'selected');},mouseout:function(event){pa&&m.removeClass(pa,'selected');pa&&m.removeClass(pa,'notifHover');pa=null;},mousedown:this.onContentMouseDown.bind(this)});p.listen(this.wrapper,'mouseover',this.onMouseOver.bind(this));aa.listen('show',this.wrapper,this.onClick.bind(this));aa.listen('hide',this.wrapper,this.onHide.bind(this));this.shouldLogImpressions&&aa.listen('show',this.wrapper,this._logImpression.bind(this));var qa=function(sa){this._poller.request();this.notifLogger.bump(sa);}.bind(this);z.subscribe(z.TIME_TRAVEL,qa.curry(this.TIME_TRAVEL));z.subscribe(z.ONLINE,function(sa,ta){ta&&qa(this.ONLINE);});var ra=1000*60*60;ca.subscribe(function(sa,ta){(ta.idleness>ra)&&qa(this.INACTIVE_REFRESH);}.bind(this));this.negativeNotifs={};this._initNotifNegativeFeedback();if(this.useInfiniteScroll){this._setupScroll();this._initializeScrollEvents();this._updateScrollDataStructures.bind(this).defer();this._hideOverflow();}},_setupScroll:function(){this._scrollArea=n.scry(this.jewelFlyout,'div.uiScrollableAreaWrap')[0];this._morePagerLink=n.find(this.jewelFlyout,'.notifMorePager a');this._morePager=v.byClass(this._morePagerLink,'notifMorePager')||this._morePagerLink;this._infiniteScrollNotif=null;this.afterFirstFetch=false;this.animate=false;if(a.MinNotifications&&a.MinNotifications.fetched()){this.afterFirstFetch=true;m.show(this._morePager);}},_initializeScrollEvents:function(){p.listen(this._scrollArea,'scroll',la(this._handleScroll.bind(this)));p.listen(this._morePagerLink,'success',function(oa){this.fetchHandler(oa.getData().response);}.bind(this));},_updateScrollDataStructures:function(){var oa=this.alertList.getIds(),pa=Math.max(0,oa.length-this._autoLoadNotifIndex);this._infiniteScrollNotif=this.alertList.getDomObj(oa[pa]);this._annotateMorePagerURI();},_annotateMorePagerURI:function(){this._morePagerLink.setAttribute('ajaxify',new ba(this._morePagerLink.getAttribute('ajaxify')).addQueryData({earliest_time:this.alertList.getEarliestNotifTime()}));},onContentMouseDown:function(event){var oa=v.byTag(event.getTarget(),this.alertList.ITEM_TAG),pa=oa&&t.getIdFromDom(oa);if(pa&&this.alertList.isUnreadId(pa))this.markRead(true,[pa]);},onMouseOver:function(event){if(m.hasClass(event.getTarget(),"jewelButton"))this.ua=ma('notifs',event.target,event,{mode:'DEDUP'}).uai('mouseover','jewel').add_event('hover');this.fetch();},onClick:function(){a.ArbiterMonitor&&this.fetch!=ha&&h.registerCallback(ha,['notifs/fetched']);this.ua.add_event('show');this.fetch();this.markRead(true);this._hideOverflow();if(this.scrollableAreaNode){var oa=x.getInstance(this.scrollableAreaNode);oa&&oa.poke();}},onHide:function(){this.animate=false;this.animation&&this.animation.stop();this.ua.add_event('hide');this.markRead(true);this._dequeueNotifications();},_dequeueNotifications:function(){this.queuedNotifications.forEach(function(oa){this._displayNotification(oa.type,oa.data);},this);this.queuedNotifications.length=0;},_handleScroll:function(){if(this._checkInfiniteScroll()){this._autoLoadNotifIndex=5;this._sendFetchRequest(this._morePager);}},_handleInsert:function(oa,pa){if(pa.is_new)this._newDataFromInsert=true;this._updateScrollDataStructures();},_checkInfiniteScroll:function(){if(this._infiniteScrollNotif&&this._scrollArea){var oa=ea.getElementPosition(this._infiniteScrollNotif).y,pa=ea.getElementPosition(this._scrollArea).y+ea.getElementDimensions(this._scrollArea).y;return oa<pa;}return false;},_initNotifNegativeFeedback:function(){u.init(this);this.alertList.setFilterFn(u.filterStoreClicked);aa.listen('hide',fa(this.wrapperID),function(){for(var oa in this.negativeNotifs)if(oa)this.negativeNotifs[oa] instanceof r&&this.negativeNotifs[oa].reset();}.bind(this));h.subscribe('notif/negativeCancel',function(oa,pa){this.negativeNotifs[pa.id]&&this.negativeNotifs[pa.id].restore();}.bind(this));h.subscribe('notif/negativeConfirmed',function(oa,pa){this.negativeNotifs[pa.id]&&this.negativeNotifs[pa.id].onTurnedOff();this.alertList.toggleNotifsSimilarTo(pa.id,true,true);this._hideOverflow();this._handleScroll();}.bind(this));h.subscribe('notif/negativeUndid',function(oa,pa){this.negativeNotifs[pa.id]&&this.negativeNotifs[pa.id].onUndid();this.alertList.toggleNotifsSimilarTo(pa.id,false,true);this._hideOverflow();}.bind(this));h.subscribe('notif/negativeMarkedSpam',function(oa,pa){this.negativeNotifs[pa.id]&&this.negativeNotifs[pa.id].onMarkedSpam();}.bind(this));h.subscribe('notif/negativeFirstReceiptYes',function(oa,pa){this.negativeNotifs[pa.id]&&this.negativeNotifs[pa.id].onFirstReceiptYes();this.alertList.toggleNotifsSimilarTo(pa.id,false,true);}.bind(this));h.subscribe('notif/negativeFirstReceiptNo',function(oa,pa){this.negativeNotifs[pa.id]&&this.negativeNotifs[pa.id].onFirstReceiptNo();this.alertList.toggleNotifsSimilarTo(pa.id,false,true);}.bind(this));this.alertList.subscribe(t.INSERTION_TYPE,function(oa,pa){this._updateFirstReceipt(pa);var qa=n.scry(pa.obj,'.notif_x');if(qa.length==1)this.negativeNotifs[pa.id]=new r(this,pa);}.bind(this));},_sendIDs:function(oa,pa,qa){var ra=qa||{};for(var sa=0;sa<oa.length;++sa)ra['alert_ids['+sa+']']=oa[sa];new j(ba(pa).getQualifiedURI().toString(),ra).send();},_waitForFetch:function(oa){return this.currentFetchRequest&&this.fetchListeners.push(oa.bind(this));},_logImpression:function(){var oa=this.alertList.getIds();if(oa.length===0&&this._waitForFetch(this._logImpression))return;this.logImpressionIds(oa,this.NOTIF_JEWEL_REF);},logImpressionIds:function(oa,pa){this.shouldLogImpressions&&this._sendIDs(oa,'/ajax/notifications/impression.php',{ref:pa});},markRead:function(oa,pa){var qa=!ja(pa);pa=qa?this.alertList.getUnseenIds():pa.filter(this.alertList.isUnreadId.bind(this.alertList));if(pa.length){oa&&this._sendIDs(pa,'/ajax/notifications/mark_read.php',{seen:qa?1:0});if(ia('jewelNoticeMessage')&&this.logAutoShutOffImpression){new j('/ajax/notifications/auto_shutoff_seen.php').send();this.logAutoShutOffImpression=false;}var ra=oa;qa?this.alertList.markSeen(pa):this.alertList.markRead(pa,ra);}qa&&this._waitForFetch(this.markRead.bind(this,oa));},markAllRead:function(){var oa=this.alertList.getUnreadIds();this.markRead(true,oa);},_updateErrorHandler:function(oa){},_updateURI:'/ajax/presence/update.php',_update:function(oa){oa.setHandler(this._handleUpdate.bind(this)).setOption('suppressErrorAlerts',true).setErrorHandler(this._updateErrorHandler.bind(this)).setData({notif_latest:this.latest_notif_time,notif_latest_read:this.latest_read_notif_time}).setURI(this._updateURI).setAllowCrossPageTransition(true);},_handleUpdate:function(oa){var pa=oa.payload.notifications;if(!pa.no_change){this.updateTime=oa.payload.time;this.latest_notif_time=pa.latest_notif;this.latest_read_notif_time=pa.latest_read_notif;this._updateDisplay();this.alertList.insertMany(pa.notifications);}},_updateDisplay:function(){if(!this.content)return;this._updateCount();},_updateCount:function(){h.inform('jewel/count-updated',{jewel:'notifications',count:this.alertList.unseenCount},h.BEHAVIOR_STATE);this._hideOverflow();},fetch:function(oa){this._sendFetchRequest(oa);},_getFetchQueryData:function(){var oa={time:this.latest_notif_time,user:this.user,version:this.cache_version,locale:o.locale};if(this.useInfiniteScroll)oa.earliest_time=this.alertList.getEarliestNotifTime();return oa;},_sendFetchRequest:function(oa){if(this.useInfiniteScroll){this._infiniteScrollNotif=null;this._newDataFromInsert=false;this._truncate=true;}var pa=ba('/ajax/notifications/get.php'),qa=oa||this.loadingIndicator;if(this.currentFetchRequest)return true;this.ua.add_event('fetch');pa.setQueryData(this._getFetchQueryData());this.currentFetchRequest=new i().setURI(pa).setStatusElement(qa).setMethod('GET').setReadOnly(true).setTimeoutHandler(30000,this.fetchErrorHandler.bind(this)).setHandler(this.fetchHandler.bind(this)).setErrorHandler(this.fetchErrorHandler.bind(this)).setAllowCrossPageTransition(true);!this.currentFetchRequest.send()&&this.fetchErrorHandler();return true;},fetchErrorHandler:function(oa){this.currentFetchRequest=null;this.ua.add_event('fetch_error');this.loadingIndicator&&m.hide(this.loadingIndicator);this.useInfiniteScroll&&this._updateScrollDataStructures();},fetchHandler:function(oa){this.ua.add_event('fetch_success');var pa=oa.getPayload();this.alertList.insertMany(pa.notifications,true);this.loadingIndicator&&m.hide(this.loadingIndicator);this.loadingIndicator=null;this.currentFetchRequest=null;this.fetch=ha;if(this.fetchListeners){for(var qa=0;qa<this.fetchListeners.length;qa++)this.fetchListeners[qa]();this.fetchListeners=[];}a.ArbiterMonitor&&h.inform('notifs/fetched','',h.BEHAVIOR_STATE);var ra=pa.generated,sa=Math.round(Date.now()/1000);if(sa-ra>15)ra=sa;k.loadModules(['LiveTimer'],function(ta){ta.restart(ra);ta.startLoop(0);});if(this.useInfiniteScroll){if(ka(pa.notifications)||!this._newDataFromInsert){this._noMoreNotifications();}else m.show(this._morePager);this._updateScrollDataStructures();if(this.isNotifJewelOpen()&&this.afterFirstFetch)this.animate=true;this.afterFirstFetch=true;}this._hideOverflow();},_noMoreNotifications:function(){m.hide(this._morePager);this.useInfiniteScroll=false;},_mergeNotification:function(oa,pa,qa,ra){var sa=!this.alertList.isUnreadId(oa);this.alertList.insert(oa,pa,qa,true,null,ra||null);this.latest_notif_time=0;if(sa)this._updateCount();var ta=this.alertList.getDomObj(oa);if(ta)k.loadModules(['LiveTimer'],function(ua){ua.addTimeStamps(ta);});},_handleNotificationMsg:function(oa,pa){if(this.isNotifJewelOpen()){var qa={type:oa,data:pa};this.queuedNotifications.push(qa);}else this._displayNotification(oa,pa);},_displayNotification:function(oa,pa){var qa=pa.obj;if(typeof this.useDesktopNotifications=='undefined')this.useDesktopNotifications=this.allowDesktopNotifications&&window.webkitNotifications&&window.webkitNotifications.checkPermission()===0;if(this.useDesktopNotifications)k.loadModules(['DesktopNotifications'],function(ra){ra.addNotification(qa.alert_id);});if(qa.markup){this._mergeNotification(qa.alert_id,qa.time,qa.markup,qa.alt_id||null);}else this._poller.request();},_handleNotificationsReadMsg:function(oa,pa){var qa=pa.obj;this.markRead(false,qa.alert_ids);},_handleNotificationsSeenMsg:function(oa,pa){if(!this.unseenVsUnread){this._handleNotificationsReadMsg(oa,pa);return;}var qa=pa.obj;this.alertList.markSeen(qa.alert_ids);},_hideOverflow:function(){if(!this.isNotifJewelOpen())return;var oa=n.scry(fa('fbNotificationsList'),'.notification');this.scrollableAreaNode=this.scrollableAreaNode||n.scry(this.jewelFlyout,'.uiScrollableArea')[0];var pa=20,qa=m.hasClass(document.documentElement,'tinyViewport')&&!m.hasClass(document.body,'fixedBody');if(!oa.length||qa){y.set(this.scrollableAreaNode,'height','100%');this.notifLogger.rate(this.SCROLL_OFF_TINY,qa);return;}var ra=this.scrollableAreaNode||oa[0],sa=ea.getViewportDimensions().y-ea.getElementPosition(ra,'viewport').y-ea.getElementDimensions(this.footer).y-5,ta=sa,ua=0;for(;ua<oa.length&&ta>0;++ua)if(m.shown(oa[ua]))ta-=ea.getElementDimensions(oa[ua]).y;var va=530,wa=Math.min(va,sa-Math.max(ta,0));if(ta>=0&&wa<va){if(!this.useInfiniteScroll){wa='100%';}else{if(this._truncate&&oa.length>=5)wa-=pa;wa+='px';}}else wa+='px';if(this.useInfiniteScroll&&this.animate&&wa!='100%'){this.animation&&this.animation.stop();this.animation=new g(this.scrollableAreaNode).to('height',wa).duration(200).go();}else{var xa=x.getInstance(this.scrollableAreaNode);xa&&xa.showScrollbar.bind(xa).defer();y.set(this.scrollableAreaNode,'height',wa);}},_updateFirstReceipt:function(oa){var pa=oa.obj.getAttribute('data-appid'),qa=n.scry(oa.obj,'.first_receipt_div');if(pa&&qa.length==1){if(this.firstReceiptMap[pa]){if(oa.id!=this.firstReceiptMap[pa].id&&this.firstReceiptMap[pa].time>oa.time)return;m.removeClass(this.firstReceiptMap[pa].obj,'first_receipt');}this.firstReceiptMap[pa]=oa;m.addClass(oa.obj,'first_receipt');}},isNotifJewelOpen:function(){var oa=aa.getInstance(this.wrapper).getActive();return (oa===this.wrapper&&m.hasClass(oa,'openToggler'));}});e.exports=na;});
__d("legacy:original-notifications-jewel",["Notifications"],function(a,b,c,d){a.Notifications=b('Notifications');},3);
__d("PagesVoiceBar",["$","Arbiter","AsyncRequest","CSS","ChannelConstants","DOM","PageTransitions"],function(a,b,c,d,e,f){var g=b('$'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('CSS'),k=b('ChannelConstants'),l=b('DOM'),m=b('PageTransitions'),n='PagesVoiceBar/toggle',o='PagesVoiceBar/initialized',p='PagesVoiceBar/switchVoice',q='page_transition',r='pages_voice_bar_sync',s=null,t=null,u=false,v=false;function w(){v=!v;j.conditionClass(document.body,'hasVoiceBar',v);}function x(da,ea){new i('/ajax/pages/switch_voice.php').setData(ea).setHandler(function(fa){ba();}).send();}function y(){s=null;}function z(da,ea){if(ea.obj.profile_id&&ea.obj.profile_id==s)ba();}function aa(da){h.subscribe(o,da);}function ba(){m.getNextURI().go();}var ca={initVoiceBar:function(){if(u)return;t=g('pagesVoiceBarContent');v=j.hasClass(document.body,'hasVoiceBar');h.subscribe(n,w);h.subscribe(p,x);h.subscribe(q,y);h.subscribe(k.getArbiterType(r),z);u=true;h.inform(o,null,h.BEHAVIOR_STATE);},update:function(da,ea){aa(function(){s=ea;l.setContent(t,da);});}};e.exports=ca;});
__d("PrivacyLiteFlyout",["Event","function-extensions","Animation","Arbiter","ArbiterMixin","AsyncRequest","CSS","DOM","Ease","Parent","Selector","Style","Toggler","copyProperties","cx","csx","ge"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('Animation'),i=b('Arbiter'),j=b('ArbiterMixin'),k=b('AsyncRequest'),l=b('CSS'),m=b('DOM'),n=b('Ease'),o=b('Parent'),p=b('Selector'),q=b('Style'),r=b('Toggler'),s=b('copyProperties'),t=b('cx'),u=b('csx'),v=b('ge'),w='PrivacyLiteFlyout/expandingSection',x={},y={};function z(ea,fa,ga){var ha=fa?0:ea.offsetHeight;q.set(ea,'height',ha+'px');q.set(ea,'overflow','hidden');l.show(ea);var ia=fa?ea.scrollHeight:0,ja=m.getID(ea);x[ja]&&x[ja].stop();x[ja]=new h(ea).to('height',ia).ondone(function(){x[ja]=null;q.set(ea,'height','');q.set(ea,'overflow','');ia||l.hide(ea);ga();}).duration(Math.abs(ia-ha)*1.5).ease(n.sineOut).go();}var aa=null,ba=false,ca=false,da=s({loadBody:function(ea){if(!ba&&v('fbPrivacyLiteFlyoutLoading')){ba=true;if(!ea)ea=false;new k('/ajax/privacy/privacy_lite/loader').setData({from_megaphone:ea}).send();}},renderBody:function(ea){var fa=v('fbPrivacyLiteFlyoutLoading');if(fa){m.replace(fa,ea);da.inform('load',null,i.BEHAVIOR_STATE);}},hideCleanup:function(ea){i.inform(w);var fa=m.scry(ea,"._2va0").forEach(function(ga){l.removeClass(ga,"_2va0");});},registerFlyoutToggler:function(ea,fa){aa=fa;var ga=r.createInstance(ea);ga.setSticky(false);r.listen(['show','hide'],fa,function(ha){da.inform(ha);ca=ha==='show';if(!ca){da.hideCleanup(ea);ga.hide();}});},registerReminderFlyout:function(ea){if(ca)return;ea.setOffsetY(o.byClass(ea.getContext(),'hasSmurfbar')?15:-5);da.subscribe('show',function(){ea.hide();});ea.show();},isFlyoutVisible:function(){return aa&&r.getActive()===aa;},exists:function(){return !!m.scry(document.body,"._91j")[0];},setFlyoutVisible:function(ea){ea?r.show(aa):r.hide(aa);},showSection:function(ea){var fa=y[ea],ga=fa.chevron,ha=fa.sublist_container;i.inform(w,ga);if(da.inform('expand',ea)!==false){l.removeClass(ga,"_9or");l.addClass(ga,"_9os");z(ha,true,function(){da.inform('expanded',ea);});}},hideSection:function(ea,fa,ga){var ha=y[ea],ia=ha.chevron,ja=ha.sublist_container;if(ga===ia)return;if(da.inform('collapse',ea)!==false){l.addClass(ia,"_9or");l.removeClass(ia,"_9os");z(ja,false,function(){da.inform('collapsed',ea);});}},toggleSection:function(ea){var fa=y[ea].chevron;r.getInstance(fa).hide();if(l.hasClass(fa,"_9or")){da.showSection(ea);new k('/ajax/privacy/privacy_lite/log_section_expand').setData({section:ea}).send();}else da.hideSection(ea);},registerSection:function(ea,fa){y[ea]=fa;i.subscribe(w,da.hideSection.curry(ea));g.listen(fa.section_block,'click',da.toggleSection.curry(ea));},registerInlineHelpOnAudienceChange:function(ea,fa,ga){p.subscribe('select',function(ha,ia){if(ia.selector!=ea)return;l.addClass(fa,"_2va0");if(ga)new k('/ajax/privacy/privacy_lite/kill_intro').send();});},registerInlineHelpXOutOnClick:function(ea,fa){g.listen(ea,'click',l.addClass.curry(fa,"_9p0"));},registerBlockUnhideOnFocus:function(ea,fa){g.listen(ea,'focus',l.show.curry(fa));},registerMessageFilterSettingOnClick:function(ea,fa){var ga=m.find(ea,"._fv0");g.listen(ea,'click',function(){if(ga.checked)new k('/ajax/mercury/change_filtering_type.php').setData({filtering_type:fa,source:'privacy_lite'}).send();});}},j);e.exports=da;});
__d("PrivacyLiteFlyoutHelp",["Event","Arbiter","AsyncRequest","ContextualHelpSearchController","CSS","DOM","Parent","copyProperties","csx","cx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('ContextualHelpSearchController'),k=b('CSS'),l=b('DOM'),m=b('Parent'),n=b('copyProperties'),o=b('csx'),p=b('cx'),q,r;function s(t,u,v,w,x){this._width=315;r=l.find(u,'input');var y=l.create('div');this.init(t,r,y,v,w);q=m.byClass(u,"_8-a");g.listen(x,'click',this._hideSearch.bind(this));h.subscribe('PrivacyLiteFlyout/expandingSection',this._hideSearch.bind(this));var z=l.scry(q,"._d1r")[0];z&&g.listen(z,'click',function(){k.addClass(q,"_aw6");r.focus();if(!this.suggestedResults)new i('/ajax/privacy/privacy_lite/help_suggestions').setHandler(function(aa){var ba=aa.getPayload().searchSuggestions,ca=l.find(q,"._4_8m");l.setContent(ca,ba);k.addClass(q,"_4_8l");}.bind(this)).send();}.bind(this));}n(s.prototype,new j(),{source:'privacy_shortcuts',_hideSearch:function(){this.clearResults();k.removeClass(q,"_aw6");},show:function(t){if(t===this.topics_area){k.removeClass(q,"_aw7");return;}else if(t===this.loader){k.addClass(q,"_aw7");k.hide(this.results_area);}else k.hide(this.loader);k.show(t);}});e.exports=s;});
__d("LayerSlowlyFadeOnShow",["Class","LayerFadeOnShow","emptyFunction"],function(a,b,c,d,e,f){var g=b('Class'),h=b('LayerFadeOnShow'),i=b('emptyFunction');function j(k){this.parent.construct(this,k);}g.extend(j,h);j.prototype._getDuration=i.thatReturns(500);e.exports=j;});
__d("PrivacyLiteNUXController",["AsyncRequest","CSS","Event","LayerSlowlyFadeOnShow","Locale","ModalMask","PageTransitions","Parent","PrivacyLiteFlyout","Toggler","$","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('Event'),j=b('LayerSlowlyFadeOnShow'),k=b('Locale'),l=b('ModalMask'),m=b('PageTransitions'),n=b('Parent'),o=b('PrivacyLiteFlyout'),p=b('Toggler'),q=b('$'),r=b('copyProperties'),s=b('cx'),t="_3oye",u="_1luv",v=[],w={bootload:function(){},init:function(y){if(!w.initialized)r(this,{dialog:y.dialog,sectionID:y.sectionID,subsectionID:y.subsectionID,initialized:true,tourStarted:false});if(y.showOnExpand){w._attachFlyoutListener();}else w._detachFlyoutListener();},startTourFromAnywhere:function(){w._startTour(false);},startTourFromMegaphone:function(){w._startTour(true);},_startTour:function(y){if(w.tourStarted)return;w.tourStarted=true;w._detachFlyoutListener();new g('/ajax/privacy/privacy_lite/log_nux_imp').setData({from_megaphone:y}).send();l.show();h.conditionClass(w.dialog.getRoot(),t,y);if(!y)w._maskListener=i.listen(q('modalMaskOverlay'),'click',w._cleanup);p.setSticky(true);setTimeout(w._showFlyout);m.registerHandler(function(){w._cleanup();o.setFlyoutVisible(false);},10);},_showFlyout:function(){o.loadBody(true);o.setFlyoutVisible(true);w._initDialog();x('load',w._showTour);},_showTour:function(){o.showSection(w.sectionID);x('expanded',function(y,z){if(z===w.sectionID)w.dialog.setContext(q(w.subsectionID)).setOffsetY(20).show();});x(['collapse','hide'],w._cleanup);},_initDialog:function(){var y=w.dialog.getRoot(),z=w.dialog.getContent();h.addClass(y,"_1luy");h.conditionClass(y,"_3qz8",k.isRTL());h.addClass(z,"_1luz");w.dialog.enableBehavior(j);i.listen(y,'click',function(event){if(n.byClass(event.getTarget(),u))w._cleanup();});},_attachFlyoutListener:function(){if(!w.flyoutSubscription)if(o.isFlyoutVisible()){w.startTourFromAnywhere();}else w.flyoutSubscription=o.subscribe('show',w.startTourFromAnywhere);},_detachFlyoutListener:function(){if(w.flyoutSubscription){w.flyoutSubscription.unsubscribe();w.flyoutSubscription=null;}},_cleanup:function(){if(!w.tourStarted)return;w.tourStarted=false;p.setSticky(false);l.hide();w.dialog.hide();while(v.length)v.pop().unsubscribe();if(w._maskListener){w._maskListener.remove();w._maskListener=null;}}};function x(y,z){v.push(o.subscribe(y,z));}e.exports=w;});
__d("ViewasChromeBar",["Event","Arbiter","AsyncRequest","CSS","DOM","Focus","ModalMask","PageTransitions","Parent","cx","csx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('CSS'),k=b('DOM'),l=b('Focus'),m=b('ModalMask'),n=b('PageTransitions'),o=b('Parent'),p=b('cx'),q=b('csx'),r='ViewasChromeBar/initialized',s=null,t=false;function u(x){h.subscribe(r,x);}function v(x){j.addClass(x,"_7g7");var y=k.find(x,"._7g0");l.set(k.find(y,'.textInput'));}var w={initChromeBar:function(x){if(t)return;s=x;t=true;h.inform(r,null,h.BEHAVIOR_STATE);},update:function(x,y){u(function(){k.setContent(s,x);if(y)new i('/ajax/privacy/glasgow/viewas_bar_flyout_open').send();});},registerSpecificModeOnClick:function(x){g.listen(x,'click',v.curry(o.byClass(x,"_7f-")));},registerFlyoutModalMask:function(){m.show();n.registerHandler(m.hide,10);}};e.exports=w;});
__d("TypeaheadSearchSponsoredUtils",[],function(a,b,c,d,e,f){function g(o){return o.selected_target_id!=o.s_target;}function h(o,p){return Math.min(p.maxNumberAds,p.maxNumberRemovedResults+p.maxNumberResultsAndAds-o);}function i(o,p){var q={};for(var r=o.length-1;r>=0;--r){var s=o[r];q[s]=s;if(p.hasOwnProperty(s))p[s].forEach(function(t){q[t]=s;});}return q;}function j(o,p,q){for(var r=p;r<o.length;r++)o[r].setDebugString&&o[r].setDebugString(q);}function k(o,p){return p.indexOf(String(o))!=-1;}function l(o,p,q,r){if(n.isSelfPromoted(o))return false;if(q+p.length<r.maxNumberResultsAndAds)return false;return true;}function m(o,p,q,r){var s=o[o.length-1];if(p.hasOwnProperty(s))return false;if(s==q)return false;if(s==r)return false;return true;}var n={isSelfPromoted:function(o){return o.uid==o.s_target;},prepareAndSortAds:function(o,p,q){if(!p)return [];var r=[],s=o.length,t={};for(var u=0;u<s;u++){var v=o[u];t[v.uid]=true;if(v.s_categories)v.s_categories.forEach(function(z){t[z]=true;});}for(var w in t)if(p[w])for(var x in p[w]){var y=p[w][x];if(q&&q.hasOwnProperty(y.uid))continue;r.push(y);}r.sort(function(z,aa){return aa.s_value-z.s_value;});return r;},selectAds:function(o,p,q,r,s){var t=[],u={},v={},w={},x=0,y=h(o.length,r),z=i(o,p);for(var aa=0;aa<q.length;aa++){if(t.length>=y){j(q,aa,'filtered: '+y+' ads already selected');break;}var ba=q[aa],ca=z[ba.s_target]||ba.s_target;ba.selected_target_id=ca;if(!k(ca,o)){ba.setDebugString&&ba.setDebugString('filtered: targeted organic '+ca+' does not exist. '+'promoted id '+ba.uid);continue;}if(l(ba,o,x,r)&&!m(o,v,ca,s)){ba.setDebugString&&ba.setDebugString('filtered: last organic need but cannot be removed');continue;}if(!n.isSelfPromoted(ba)&&o.indexOf(String(ba.uid))!=-1){ba.setDebugString&&ba.setDebugString('filtered: organic '+ba.uid+' targets another organic '+ca);continue;}if(u.hasOwnProperty(ba.s_account)){ba.setDebugString&&ba.setDebugString('filtered: ad account '+ba.s_account+' already selected');continue;}if(w.hasOwnProperty(ba.uid)){ba.setDebugString&&ba.setDebugString('filtered: ad promoted id '+ba.uid+' already selected');continue;}ba.setDebugString&&ba.setDebugString('selected');t.push(ba);u[ba.s_account]=true;v[ca]=true;w[ba.uid]=true;if(!n.isSelfPromoted(ba)){++x;if(x+o.length>r.maxNumberResultsAndAds)o.pop();}}return t;},hasTopResult:function(o,p,q){if(o==null)return false;if(o.type=='user')return false;if(o.type=='grammar')return false;if(o.score>q.v0)return true;if(o.s_value>q.v3)return true;if(o.s_value>p.s_value)return true;var r=g(p)?q.v4:(o.bootstrapped?q.v1:q.v2);if(r<p.s_value)return false;return true;},setOrganicECPM:function(o,p){if(o==null)return;for(var q=0;q<p.length;q++)if(o.hasOwnProperty(p[q].uid))p[q].s_value=o[p[q].uid];return;},buildResultIndices:function(o){var p={},q=o.length;for(var r=0;r<q;r++)p[o[r].uid]=r;return p;},getTopAdPosition:function(o,p,q){if(o.length<1)return null;if(p.length<1)return null;if((o[0].type=='user')||(o[0].type=='grammar')){for(var r=1;r<o.length;++r)if(o[r].type!=o[0].type)return r;return o.length;}if(n.hasTopResult(o[0],p[0],q))return 1;return 0;}};e.exports=n;});
__d("TypeaheadSearchSponsored",["Event","Arbiter","CSS","DOM","URI","copyProperties","TypeaheadSearchSponsoredUtils","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('CSS'),j=b('DOM'),k=b('URI'),l=b('copyProperties'),m=b('TypeaheadSearchSponsoredUtils'),n=b('tx');function o(p){this._typeahead=p;}o.auctionOptions={};o.query=null;o.getOriginalOrganics=function(p){return p.map(function(q){return {uid:q.uid,text:q.text,type:o.getRealType(q),source:q.bootstrapped?1:0,index:q.index,s_value:q.s_value||0,s_categories:q.s_categories||[],score:q.score};});};o.setTopResult=function(p){p[0].renderTypeOverride=true;p[0].orig_render_type=p[0].render_type;p[0].render_type='tophit';};o.bucketResults=function(p){var q,r,s,t,u=[],v={};r=p.length;for(q=0;q<r;q++){s=p[q];t=s.render_type||s.type;if(!v.hasOwnProperty(t)){v[t]=u.length;u.push([]);}u[v[t]].push(s);}var w=[],x={};r=u.length;for(q=0;q<r;++q){s=u[q][0];t=s.render_type||s.type;x[t]=w.length;w=w.concat(u[q]);}return {results:w,buckets:x};};o.finalizeAd=function(p,q,r){var s="Sponsored";p.rankType=p.rankType||p.render_type||p.type;if(m.isSelfPromoted(p)){q.s_token=p.s_token;q.message=p.s_message;if(r.rerankingStrategy===0)q.subtextOverride=q.subtext?q.subtext+' \xB7 '+s:s;if(p.path){q.pathOverride=true;q.orig_path=q.path;q.path=p.path;}q.is_self=true;}else{p.message=p.s_message;p.subtextOverride=null;if(r.rerankingStrategy===0)p.subtextOverride=p.subtext?p.subtext+' \xB7 '+s:s;if(r.debug){if(!p.subtextOverride&&p.subtext)p.subtextOverride=p.subtext;if(p.subtextOverride){p.subtextOverride+=' \xB7 (Debug: '+q.text+')';}else p.subtextOverride='(Debug: '+q.text+')';}p.type=q.type;p.render_type=q.render_type;p.is_self=false;}};o.promoteSelfPromotedResultToTop=function(p,q,r,s){var t=p[q];if(q<r){var u="Sponsored";t.subtextOverride=t.subtext?t.subtext+' \xB7 '+u:u;return;}if(q>r)p.splice(r,0,p.splice(q,1)[0]);t=p[r];t.renderTypeOverride=true;t.orig_render_type=t.render_type;t.render_type='ownsection';};o.insertAdToTop=function(p,q,r,s){p.splice(r,0,q);q.render_type='ownsection';};o.rerankMethod5=function(p,q,r){if(r.rerankingStrategy!=5)return;var s=m.getTopAdPosition(p,q,r),t=m.buildResultIndices(p);for(var u=q.length-1;u>=0;u--){var v=q[u],w=t[v.selected_target_id],x=p[w];o.finalizeAd(v,x,r);if(m.isSelfPromoted(v)){o.promoteSelfPromotedResultToTop(p,w,s,r);}else o.insertAdToTop(p,v,s,r);t=m.buildResultIndices(p);}};o.rerankAds=function(p,q,r){switch(r.rerankingStrategy){case 5:o.rerankMethod5(p,q,r);break;default:break;}p.length=Math.min(p.length,r.maxNumberResultsAndAds);return p;};o.initResults=function(p){var q=p.length;for(var r=0;r<q;r++){var s=p[r];s.is_self=null;s.s_token=null;s.message=null;s.subtextOverride=null;if(s.pathOverride){s.path=s.orig_path;s.pathOverride=false;}if(s.renderTypeOverride){s.render_type=s.orig_render_type;s.renderTypeOverride=false;}s.rankType=s.rankType||s.render_type||s.type;}return p;};o.setAuctionOptions=function(p){l(o.auctionOptions,p);};o.getRealType=function(p){if(p.renderTypeOverride)return p.orig_render_type||p.type;return p.render_type||p.type;};o.hideAdResult=function(p,q){h.inform('TypeaheadSearchSponsored/hideAdResult',{uid:p,reason_dialog:q});};o.undoHideAdResult=function(p){h.inform('TypeaheadSearchSponsored/undoHideAdResult',{uid:p});};o.Ad=function(){};l(o.prototype,{_dataSubscriptions:null,_viewSubscriptions:null,_globalSubscriptions:null,_data:null,_view:null,_sponsoredEntries:null,_hiddenSponsoredEntities:null,_hideReasonDialog:null,_sBootstrapID:null,_organicECPM:null,enable:function(){this._data=this._typeahead.getData();this._dataSubscriptions=[this._data.subscribe('beginFetchHandler',function(p,q){var r=q.response.getPayload();if(r.s_entries){this._sponsoredEntries=this._sponsoredEntries||{};var s=r.s_entries.length;for(var t=0;t<s;t++){var u=new o.Ad();l(u,r.s_entries[t]);var v=u.s_target;if(!this._sponsoredEntries[v])this._sponsoredEntries[v]={};this._sponsoredEntries[v][u.uid]=u;}if(r.s_bootstrap_id)this._sBootstrapID=r.s_bootstrap_id;if(r.organic_s_value)this._organicECPM=l(this._organicECPM,r.organic_s_value);}}.bind(this))];if(o.auctionOptions.bootstrap)this._dataSubscriptions.push(this._data.subscribe('onload',function(p,q){var r=l(this.bootstrapData,{no_cache:1,options:['sponsored']});this.fetch(this.bootstrapEndpoint,r,{type:'sponsored'});}.bind(this._data)));this._view=this._typeahead.getView();this._viewSubscriptions=[this._view.subscribe('finalResultsReordering',function(p,q){o.query=q.value;m.setOrganicECPM(this._organicECPM,q.results);var r=o.getOriginalOrganics(q.results);o.setAuctionOptions({maxNumberResultsAndAds:Math.max(q.results.length,(this._data&&this._data._maxResults)||o.auctionOptions.maxNumberResultsAndAds)});var s=this.runAuction(q.results,this._sponsoredEntries,this._hiddenSponsoredEntities,o.auctionOptions);this._view.inform('recordAfterReorder',{organic:r,s_bootstrap_id:this._sBootstrapID,options:o.auctionOptions,variant:o.auctionOptions.rerankingStrategy});q.results=s;this._data.inform('recordAuctionState',{organic:r,auctionOptions:o.auctionOptions,event_data:q});}.bind(this)),this._view.subscribe('highlight',function(p,q){if(this._view.content)j.scry(this._view.content,'a.report').forEach(i.hide);if(!q.element||!q.selected||!q.selected.s_token)return;var r=j.scry(q.element,'a.report');if(r.length){i.show(r[0]);}else j.appendContent(q.element,this._createHideAdLink(q.selected));}.bind(this)),this._view.subscribe('resultsAfterBucketization',function(p,q){var r=[],s=0;q.forEach(function(t,u){if(t.type=='header'){++s;return;}if(t.s_token)r.push({position:u-s,is_self:t.is_self});});this._view.inform('recordAfterReorder',{position_data:r});}.bind(this))];this._globalSubscriptions=[h.subscribe('TypeaheadSearchSponsored/hideAdResult',function(p,q){this._hiddenSponsoredEntities=this._hiddenSponsoredEntities||{};this._hiddenSponsoredEntities[q.uid]=true;this._hideReasonDialog=q.reason_dialog;this._forceRefreshResults();}.bind(this)),h.subscribe('TypeaheadSearchSponsored/undoHideAdResult',function(p,q){if(this._hiddenSponsoredEntities)delete this._hiddenSponsoredEntities[q.uid];if(this._hideReasonDialog){this._hideReasonDialog.hide();this._hideReasonDialog=null;}this._forceRefreshResults();}.bind(this))];},disable:function(){this._dataSubscriptions.forEach(this._data.unsubscribe.bind(this._data));this._dataSubscriptions=null;this._viewSubscriptions.forEach(this._view.unsubscribe.bind(this._view));this._viewSubscriptions=null;this._globalSubscriptions.forEach(h.unsubscribe.bind(h));this._globalSubscriptions=null;this._data=null;this._view=null;this._sponsoredEntries=null;},runAuction:function(p,q,r,s){if(p.length===0)return p;p=o.initResults(p);var t;if(!q){t=o.bucketResults(p);return t.results;}var u=m.prepareAndSortAds(p,q,r),v=u.map(function(fa){return fa.s_token;});if(this._typeahead){var w=this._typeahead.getView();w.inform('recordAfterReorder',{tokens:v});var x=this._typeahead.getData();x.inform('recordAuctionState',{sorted_ads:u});}var y={},z=p.map(function(fa){if(fa.s_categories)y[fa.uid]=fa.s_categories;return String(fa.uid);}),aa=m.selectAds(z,y,u,s);if(aa.length===0){t=o.bucketResults(p);return t.results;}if(m.hasTopResult(p[0],aa[0],s))o.setTopResult(p);var ba=0;for(var ca=0;ca<aa.length;++ca)if(!m.isSelfPromoted(aa[ca]))ba++;p.length=Math.min(p.length,s.maxNumberResultsAndAds-ba);var da=o.bucketResults(p),ea=o.rerankAds(da.results,aa,s);return ea;},_forceRefreshResults:function(){if(this._data&&this._data.value)this._data.respond(this._data.value,this._data.buildUids(this._data.value));},_createHideAdLink:function(p){var q=new k('/ajax/emu/end.php').addQueryData({eid:p.s_token,f:0,ui:'typeahead_'+p.s_token.replace('.','_'),en:'fad_hide',ed:'true',a:1}).toString(),r={className:'report',rel:'dialog-post',href:'#',ajaxify:q,title:"Hide the ad"},s=j.create('a',r);g.listen(s,'mouseover',function(event){this._view.index=-1;this._view.highlight(-1,false);event.kill();}.bind(this));return s;}});e.exports=o;});
__d("legacy:SearchSponsoredTypeaheadBehavior",["TypeaheadSearchSponsored"],function(a,b,c,d){var e=b('TypeaheadSearchSponsored');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.searchSponsored=function(f){f.enableBehavior(e);};},3);
__d("legacy:TypeaheadSearchSponsored",["TypeaheadSearchSponsored"],function(a,b,c,d){a.TypeaheadSearchSponsored=b('TypeaheadSearchSponsored');},3);
__d("SearchDataSource",["Event","Arbiter","AsyncResponse","Class","DataSource","copyProperties","createArrayFrom"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncResponse'),j=b('Class'),k=b('DataSource'),l=b('copyProperties'),m=b('createArrayFrom');function n(o){this._token=o.token||'';this._lazyonload=o.lazyonload===false?false:true;this._extraTypes=o.extraTypes;this._buckets=o.buckets;this._noMultiFetch=o.noMultiFetch||false;var p=o.maxResults||8;this.parent.construct(this,o);this._numResults={min:3,max:p};this._minWebSugg=o.minWebSugg||2;this._queryToWebSuggState={};this._genTime=o.genTime;}j.extend(n,k);l(n.prototype,{init:function(){this.parent.init();this._leanPayload=null;this._bootstrapRequestsPending=0;this._criticalOnly=true;this._updateMaxResults();g.listen(window,'resize',this._updateMaxResults.bind(this));},dirty:function(){this.parent.dirty();this._fetchOnUseRequests=[];},asyncErrorHandler:function(o){if(window.Dialog&&window.Dialog.getCurrent()==null&&o.getError()==1400003)i.verboseErrorHandler(o);},fetch:function(o,p,q){q=q||{};q.fetch_start=Date.now();this.parent.fetch(o,p,q);},fetchHandler:function(o,p){var q=o.getPayload(),r=l({fetch_end:Date.now()},p),s=r.value?h.BEHAVIOR_EVENT:h.BEHAVIOR_PERSISTENT;this.inform('beginFetchHandler',{response:o});if(p.type=='lean'){this._leanPayload=q;this._processLean();}else{if(q.coeff2_ts)r.coeff2_ts=q.coeff2_ts;var t={limit:typeof q.webSuggLimit!=='undefined'?q.webSuggLimit:6,showOnTop:typeof q.webSuggOnTop!=='undefined'?q.webSuggOnTop:false};this._queryToWebSuggState[p.value]=t;this.parent.fetchHandler(o,p);if(p.bootstrap&&!o.getRequest().getData().no_cache)r.browserCacheHit=(q.timestamp<this._genTime);if(p.bootstrap&&!q.no_data&&this._bootstrapRequestsPending>0){p.bootstrap=false;--this._bootstrapRequestsPending;!this._bootstrapRequestsPending&&this._bootstrapPostProcess();}if(q.no_data||q.stale||q.token!==this._token){var u=l({},o.getRequest().getData());if(u.lazy){delete u.lazy;u.token=this._token;this._fetchOnUse(u,p);}}}this.inform('endpointStats',r,s);},respond:function(o,p,q){this.inform('respondValidUids',p);var r=this.buildData(p,o);this.inform('respond',{value:o,results:r,isAsync:!!q});return r;},buildData:function(o,p){if(!o||o.length===0)return [];this.inform('reorderResults',o);var q=this.getWebSuggState(p),r=Math.floor(this._maxResults*q.limit),s=q.showOnTop,t=[],u=s?t:[],v=0,w=0;for(var x=0;x<o.length;x++){var y=this.getEntry(o[x]),z=w+v>=this._maxResults;if(y.type==='websuggestion'){if((!z&&v<r)||(v>0&&v<this._minWebSugg)){u.push(y);v++;}else if(z)break;}else if(!z){t.push(y);w++;}}if(!s)return t.concat(u);return t;},getWebSuggState:function(o){while(o){var p=this._queryToWebSuggState[o];if(typeof p!=='undefined')return p;o=o.slice(0,o.length-1);}return {limit:0,showOnTop:false};},shouldFetchMoreResults:function(o){var p=0;o.forEach(function(q){if(q.type!=='websuggestion')p++;}.bind(this));return p<this._maxResults;},_bootstrapPostProcess:function(){var o={time:Date.now()};this.inform('bootstrapped',o,h.BEHAVIOR_PERSISTENT);this._processLean();},_processLean:function(){if(this._leanPayload){var o,p=this._leanPayload.entries;for(var q in p){o=this.getEntry(q);o&&(o.index=p[q]);}this.setExclusions(this._leanPayload.blocked);this._leanPayload=null;}},_updateMaxResults:function(){var o=window.innerHeight||document.documentElement.clientHeight;this.setMaxResults(Math.max(this._numResults.min,Math.min(this._numResults.max,Math.ceil(2+((o-370)/56)))));},_bootstrapFetch:function(o,p){var q=l(p,this.bootstrapData);if(this._criticalOnly&&this._lazyonload)q.lazy=1;this.fetch(this.bootstrapEndpoint,q,{bootstrap:true,type:o});++this._bootstrapRequestsPending;},_fetchOnUse:function(o,p){for(var q in this.bootstrapData)!o.hasOwnProperty(q)&&(o[q]=this.bootstrapData[q]);if(this._criticalOnly){this._fetchOnUseRequests.push({args:o,ctx:p});}else this.fetch(this.bootstrapEndpoint,o,p);},_fetchLean:function(){var o={no_cache:1};o.options=m(o.options);o.options.push('lean');this._fetchOnUse(o,{type:'lean'});},bootstrap:function(o){if(!o){this._criticalOnly=false;this._flushFetchOnUseRequests();}if(this._bootstrapped)return;var p={filter:['event'],no_cache:1};this._fetchOnUse(p,{type:'event'});var q=['app','page','group','friendlist'];q=q.concat(this._extraTypes||[]);if(this._noMultiFetch){q.push('user');this._bootstrapFetch('user',{filter:q});}else{this._bootstrapFetch('other',{filter:q});if(this._buckets){for(var r=0;r<this._buckets.length;++r){var s={filter:['user'],buckets:this._buckets[r]};this._bootstrapFetch('user',s);}}else this._bootstrapFetch('user',{filter:['user']});}this._fetchLean();this._bootstrapped=true;},_flushFetchOnUseRequests:function(){var o=this._fetchOnUseRequests.length;for(var p=0;p<o;++p){var q=this._fetchOnUseRequests[p];this.fetch(this.bootstrapEndpoint,q.args,q.ctx);}if(o>0)this.inform('extra_bootstrap',{time:Date.now()},h.BEHAVIOR_PERSISTENT);this._fetchOnUseRequests=[];},onLoad:function(o,p){this.inform('onload',{time:Date.now()},h.BEHAVIOR_PERSISTENT);if(o)this.bootstrap.bind(this,p).defer();},mergeUids:function(o,p,q,r){var s=q[0]?this.getEntry(q[0]):null,t=p[0]?this.getEntry(p[0]):null,u=(s&&s.replace_results)?s:null;u=(!u&&t&&t.replace_results)?t:u;var v=this.parent.mergeUids(o,p,q,r);if(u){this.inform('backend_topreplace',{});return this.deduplicateByKey([u.uid].concat(v));}return v;}});e.exports=n;});
__d("legacy:SearchDataSource",["SearchDataSource"],function(a,b,c,d){a.SearchDataSource=b('SearchDataSource');},3);
__d("SearchTypeaheadCore",["Event","function-extensions","Arbiter","Class","DOM","Input","Parent","TypeaheadCore","copyProperties"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('Arbiter'),i=b('Class'),j=b('DOM'),k=b('Input'),l=b('Parent'),m=b('TypeaheadCore'),n=b('copyProperties');function o(p){this.parent.construct(this,p);}i.extend(o,m);n(o.prototype,{init:function(p,q,r){this.parent.init(p,q,r);var s=l.byTag(r,'form'),t=this.reset.bind(this);h.subscribe('pre_page_transition',function(event,v){var w=/^\/search/,x=w.test(v.from.path),y=w.test(v.to.path);if(x&&!y)t.defer();});if(s){var u=j.find(s,'input.search_sid_input');g.listen(s,'submit',function(){if(this.data&&this.data.queryData)u.value=this.data.queryData.sid;t.defer();}.bind(this),g.Priority.URGENT);}},select:function(){this.reset();this.element.focus();(function(){this.element.blur();}).bind(this).defer();},handleTab:function(event){var p=this.view.getQuerySuggestion(this.value);if(p){k.setValue(this.element,p);this.checkValue();event.kill();}else this.parent.handleTab(event);},getSearchType:function(){return 'regular';}});e.exports=o;});
__d("legacy:SearchTypeaheadCore",["SearchTypeaheadCore"],function(a,b,c,d){a.SearchTypeaheadCore=b('SearchTypeaheadCore');},3);
__d("SearchTypeaheadView",["Arbiter","ContextualTypeaheadView","Class","ContextualLayerUpdateOnScroll","copyProperties","DOM","goURI","MusicConstants","MusicEvents","tx","URI"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ContextualTypeaheadView'),i=b('Class'),j=b('ContextualLayerUpdateOnScroll'),k=b('copyProperties'),l=b('DOM'),m=b('goURI'),n=b('MusicConstants'),o=b('MusicEvents'),p=b('tx'),q=b('URI');function r(s,t){this.parent.construct(this,s,t);}i.extend(r,h);k(r.prototype,{initializeLayer:function(){this.parent.initializeLayer();this.layer.setOffsetY(-1);this.layer.enableBehavior(j);},ignoreClick:function(event){event.prevent();},_shouldShowSeeMore:true,_bucketize:true,queryData:{init:'quick'},render:function(s,t,u){var v={results:t,value:s};this.inform('finalResultsReordering',v);return this.parent.render(s,v.results,u);},disableBucketization:function(){this._bucketize=false;},buildBuckets:function(s,t){var u=t.length;this.setWebSuggLoggingParams(s,t);if(this._bucketize)t=this.parent.buildBuckets(s,t);this.inform('resultsAfterBucketization',t);if(s&&this._shouldShowSeeMore)t.push(this.buildSeeMore(s,u));return t;},buildSeeMore:function(s,t){var u=t>0?p._("See more results for {query}",{query:s}):p._("See results for {query}",{query:s}),v=t==1?"Displaying top result":p._("Displaying top {number} results",{number:t}),w=l.create('li',{className:'calltoaction'},[l.create('a',{href:this.getSeeMoreEndpoint(s),rel:'ignore'},[l.create('span',{className:'text'},[l.create('span',{className:'seeMore'},[u,l.create('span',{className:'arrow'})]),l.create('span',{className:'subtext'},[v])])])]);w.setAttribute('aria-label',u);return {uid:'search',node:w,search:true};},searchPageQueryData:function(s){return k({q:s},this.queryData||{});},select:function(s){var t=this.index,u=this.results[t];if(!u||u.type=='header')return;var v=this.items[t],w=l.scry(v,'a')[0];if(u.song){if(w)o.inform(n.MUSIC_BUTTON.ACTIVATE,w);s&&this.inform('highlight',{index:t,selected:u});}else{this.parent.select(s);if(w&&w.href)if(w.target=='_blank'){window.open(w.href);}else m(w.href);}},setSid:function(s){this.queryData.tas=s;},getSeeMoreEndpoint:function(s){return q(this.seeMoreEndpoint).addQueryData(this.searchPageQueryData(s)).toString();},show:function(){if(!this.isVisible()){g.inform('layer_shown',{type:'SearchTypeahead'});this.parent.show();}},hide:function(){if(this.isVisible()){g.inform('layer_hidden',{type:'SearchTypeahead'});this.parent.hide();}},getQuerySuggestion:function(s){var t=this.results[this.index],u=t&&t.type!='header'?t.text.toLowerCase():'';return u==s.toLowerCase()?'':u;},setWebSuggLoggingParams:function(s,t){var u=0,v=0;for(var w=0;w<t.length;w++)if(t[w].type==='websuggestion'){if(v===0)v=w+1;var x='FR'+(w-u)+'AS'+u,y=w+1;t[w].path+='&wssk='+x+'&wssp='+y+'&wspq='+encodeURIComponent(s);t[w].path+='&wssrc='+t[w].websuggestion_source;u++;}var z='&wssc='+t.length+'-'+s.length+'&wsbp='+u+'-'+v;for(w=0;w<t.length;w++)if(t[w].type==='websuggestion')t[w].path+=z;}});e.exports=r;});
__d("legacy:SearchTypeaheadView",["SearchTypeaheadView"],function(a,b,c,d){a.SearchTypeaheadView=b('SearchTypeaheadView');},3);
__d("legacy:Typeahead",["Typeahead"],function(a,b,c,d){a.Typeahead=b('Typeahead');},3);
__d("SearchTypeaheadRecorder",["Event","AsyncRequest","Keys","TypeaheadUtil","ge","clickRefAction","copyProperties","userAction"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('Keys'),j=b('TypeaheadUtil'),k=b('ge'),l=b('clickRefAction'),m=b('copyProperties'),n=b('userAction');function o(q){this.init(q);this.initEvents();}var p=function(q,r){var s=j.parse(r);if(s.flatValue[s.flatValue.length-1]===' ')return s.flatValue;var t=s.tokens[s.tokens.length-1],u={};q.forEach(function(z){u[z]=(u[z]||0)+1;});var v={},w=s.tokens.slice(0,s.tokens.length-1);w.forEach(function(z){v[z]=(v[z]||0)+1;});for(var x=0;x<q.length;++x){var y=q[x];if(y.indexOf(t)===0&&(u[y]-(v[y]||0)>0)){w.push(y);return w.join(' ');}}return undefined;};m(o.prototype,{_endPoint:'/ajax/typeahead/record_metrics.php',init:function(q){this.core=q.getCore();this.data=q.getData();this.view=q.getView();this.element=this.core.getElement();this.initTime=Date.now();this._onloadTime=0;this._extraRecorder=[];var r=k('search_first_focus');this.initStartTime=r&&r.value;this.bootstrapStats={bootstrapped:0};this._reset();},_reset:function(){this.stats={};this.avgStats={};this.appendStats={};this._backspacing=false;this._topreplace=false;this._inflightRequests={};this._reorderInfo=null;var q=Math.random().toString();this.data.setQueryData({sid:q});this.view.setSid(q);this.recordStat('sid',q);},initEvents:function(){this.core.subscribe('focus',function(event){if(!this.stats.session_start_time)this.recordStat('session_start_time',Date.now());}.bind(this));this.core.subscribe('blur',function(event){var q=Date.now();for(var r in this._inflightRequests){var s=this._inflightRequests[r],t=q-s;this.recordAvgStat('search_endpoint_ms_from_js',t);}this.recordStat('session_end_time',q);this.submit();}.bind(this));this.view.subscribe('select',function(q,r){this.recordSelectInfo(r);}.bind(this));this.view.subscribe('render',function(q,r){this.recordRender(r);}.bind(this));this.view.subscribe('recordAfterReorder',function(q,r){this._reorderInfo=m(this._reorderInfo,r);}.bind(this));this.data.subscribe('activity',function(q,r){this.recordStat('pending_request',r.activity);}.bind(this));this.data.subscribe('respondValidUids',function(q,r){this.validUids=r.slice(0);}.bind(this));this.data.subscribe('beforeQuery',function(q,r){if(!r.value){this.query='';this.results=[];return;}if(!this.stats.first_query_time)this.recordStat('first_query_time',Date.now());this.query=r.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('queryEndpoint',function(q,r){this.recordCountStat('num_search_ajax_requests');this.recordAvgStat('endpoint_query_length',r.value.length);this._inflightRequests[r.value]=Date.now();}.bind(this));this.data.subscribe('onload',function(q,r){this._onloadTime=r.time;}.bind(this));this.data.subscribe('bootstrapped',function(q,r){this.bootstrapStats.endTime=r.time;this.bootstrapStats.bootstrapped=1;}.bind(this));this.core.subscribe('recordFunction',function(q,r){this._extraRecorder.push(r);}.bind(this));this.data.subscribe('endpointStats',function(q,r){var s=r.fetch_end-r.fetch_start;if(r.value){this.recordAvgStat('search_endpoint_ms_from_js',s);}else this.bootstrapStats[r.type]=s;if(r.coeff2_ts)this.bootstrapStats.coeff2_ts=r.coeff2_ts;if(typeof r.browserCacheHit!='undefined')this.recordCountStat(r.browserCacheHit?'bootstrap_cachehits':'bootstrap_cachemisses');if(this._inflightRequests[r.value])delete this._inflightRequests[r.value];}.bind(this));this.data.subscribe('query',function(q,r){this.recordAvgStat('num_results_from_cache',r.results.length);}.bind(this));this.data.subscribe('backend_topreplace',function(q,r){if(false===this._topreplace){this.recordStat("backend_topreplace",1);this._topreplace=true;}}.bind(this));g.listen(this.element,'keydown',function(event){if(g.getKeyCode(event)==i.BACKSPACE){if(!this._backspacing&&this.query){this._backspacing=true;this.recordAppendStat('before_backspace_queries',this.query);}}else this._backspacing=false;}.bind(this));},recordStat:function(q,r){this.stats[q]=r;},recordCountStat:function(q){var r=this.stats[q];this.stats[q]=r?r+1:1;},recordAvgStat:function(q,r){if(this.avgStats[q]){this.avgStats[q][0]+=r;++this.avgStats[q][1];}else this.avgStats[q]=[r,1];},recordAppendStat:function(q,r){if(!this.appendStats.hasOwnProperty(q))this.appendStats[q]=[];this.appendStats[q].push(r);},recordRender:function(q){this.results=q.filter(function(r){return r.uid!='search'&&r.type!='header';});if(this.results.length>0&&!this.stats.first_result_time)this.recordStat('first_result_time',Date.now());},recordSelectInfo:function(q){var r=q.selected,s=q.index;if(r.groupIndex!==undefined)s=q.index-r.groupIndex-1;var t={href:r.path},u=r.dataGT?{gt:JSON.parse(r.dataGT)}:{};l('click',t,null,null,u);n('search').uai('click');if(r.uid=='search'){this.recordStat('selected_search',1);}else{var v=r.rankType||r.render_type||r.type,w=(v=='friend'?'user':v);this.recordStat('selected_'+w,1);this.recordStat('selected_position',s);this.recordStat('selected_type',v);this.recordStat('selected_name_length',r.text.length);this.recordStat('selected_id',r.uid);this.recordStat('selected_degree',r.bootstrapped?1:2);var x=j.parse(this.data.getTextToIndex(r)).tokens,y=p(x,this.query);if(y)this.recordStat('matched_terms',y);}var z={};this._extraRecorder.forEach(function(aa){aa(q,this.results,z);}.bind(this));this.recordStat('extra_select_info',JSON.stringify(z));if(r.type==='websuggestion'){this.recordStat('selected_memcached_websuggestion',r.fromMemcache);this.recordStat('selected_websuggestion_source',r.websuggestion_source);}this.recordStat('selected_with_mouse',q.clicked?1:0);},_dataToSubmit:function(){this.recordStat('candidate_results',this.buildResults());this.recordStat('query',this.query);this.recordStat('init_time',this.initTime);if(this.initStartTime){this.recordStat('init_start_time',this.initStartTime);this.recordStat('onload_time',this._onloadTime);this.initStartTime=0;}this.recordStat('bootstrapped',this.bootstrapStats.bootstrapped);if(this.bootstrapStats.endTime){this.recordStat('bootstrapped_time',this.bootstrapStats.endTime);this.recordStat('user_bootstrap_ms',this.bootstrapStats.user);this.recordStat('other_bootstrap_ms',this.bootstrapStats.other);this.bootstrapStats.endTime=0;}this.recordStat('coeff2_ts',this.bootstrapStats.coeff2_ts);this.recordStat('max_results',this.data._maxResults);if(this._reorderInfo){var q=this._reorderInfo;q.organic.forEach(function(u){delete u.text;});this.recordStat('s_count',q.position_data.length);this.recordStat('s_bootstrap_id',q.s_bootstrap_id);this.recordStat('s_organic_results',JSON.stringify(q.organic));this.recordStat('s_candidate_tokens',JSON.stringify(q.tokens));this.recordStat('s_positions',JSON.stringify(q.position_data));this.recordStat('s_options',JSON.stringify(q.options));this.recordStat('s_variant',JSON.stringify(q.variant));}var r=this.stats;for(var s in this.avgStats){var q=this.avgStats[s];r[s]=q[0]/q[1];}for(var t in this.appendStats)r[t]=JSON.stringify(this.appendStats[t]);return r;},buildResults:function(){var q=(this.results||[]).map(function(r,s){var t=j.parse(this.data.getTextToIndex(r)).tokens,u=r.rankType||r.render_type||r.type,v=r.bootstrapped?1:0,w=r.s_token||'',x=p(t,this.query)||this.query;if(typeof r.groupIndex=='number')return [r.groupIndex,r.indexInGroup,r.uid,u,v,w,x];return [0,s,r.uid,u,v,w,x];}.bind(this));return JSON.stringify(q);},submit:function(){var q=this._dataToSubmit();if(Object.keys(q).length>0)new h().setURI(this._endPoint).setMethod('POST').setData({stats:q}).setOption('handleErrorAfterUnload',true).setErrorHandler(function(r){q.retry=true;new h().setURI(this._endPoint).setMethod('POST').setData({stats:q}).setOption('asynchronous',false).send();}.bind(this)).send();this._reset();}});e.exports=o;});
__d("TypeaheadSearchRecorderBasic",["SearchTypeaheadRecorder","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('SearchTypeaheadRecorder'),h=b('copyProperties'),i=b('emptyFunction');function j(k){this._typeahead=k;}h(j.prototype,{enable:function(){new g(this._typeahead);},disable:i});e.exports=j;});
__d("legacy:SearchRecorderBasicTypeaheadBehavior",["TypeaheadSearchRecorderBasic"],function(a,b,c,d){var e=b('TypeaheadSearchRecorderBasic');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.searchRecorderBasic=function(f){f.enableBehavior(e);};},3);
__d("SearchTypeaheadRenderer",["DOM","Env","MusicButtonManager","TypeaheadUtil"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('Env'),i=b('MusicButtonManager'),j=b('TypeaheadUtil');function k(l,m){var n=[];if(l.photo){n.push(g.create('img',{className:'photo',alt:'',src:l.photo}));if(l.song){n.push(g.create('span',{className:'playButton'}));n.push(g.create('span',{className:'playLoader'}));}}if(l.text&&l.type=='websuggestion'&&l.photo){n.push(g.create('span',{className:'shiftedtext'},[l.text]));}else if(l.text){var o=l.alias,p=this.value,q=l.text,r=[q];if(o&&j.isQueryMatch(p,o)&&!j.isQueryMatch(p,q))r.push(g.create('span',{className:'alias'},[' \xB7 '+o]));n.push(g.create('span',{className:'text'},r));}if(l.category){var s=[l.category];if(l.is_external)s.push(g.create('span',{className:'arrow'}));var t=l.message?'preCategory':'category';n.push(g.create('span',{className:t},s));}if(l.message)n.push(g.create('span',{className:'category'},[l.message]));var u=l.subtextOverride||l.subtext;if(u)n.push(g.create('span',{className:'subtext'},[u]));var v=l.classNames||l.type||'',w=l.is_external?'_blank':'',x=!l.song&&l.path||'';if(x){if(!(/^https?\:\/\//).test(x))x=h.www_base+x.substr(1);x+=(x.indexOf('?')>0?'&':'?')+'ref=ts&fref=ts';}var y=g.create('a',{href:x,rel:'ignore',target:w},n);if(l.song){y.id='mb_'+(Math.random()*1e+06|0);i.addButton.curry(l.song.provider,y.id,l.song.url,l.song.context,l.song.media_type).defer();y.onclick=this.ignoreClick;}var z=g.create('li',{className:v},[y]);if(l.text)z.setAttribute('aria-label',l.text);return z;}k.className='search';e.exports=k;});
__d("legacy:SearchTypeaheadRenderer",["SearchTypeaheadRenderer"],function(a,b,c,d){if(!a.TypeaheadRenderers)a.TypeaheadRenderers={};a.TypeaheadRenderers.search=b('SearchTypeaheadRenderer');},3);
void(0);
__d("TypeaheadSearchFilter",["Arbiter","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties');function i(j){this._typeahead=j;}h(i.prototype,{_subscription:null,enable:function(){var j=this._typeahead;this._subscriptions=[g.subscribe('search/typeahead/updateFilter',function(k,l){if(l.filter_type=='web')j.getView().queryData.form='FBKBFR';j.getView().queryData.type=l.filter_type;}),g.subscribe('page_transition',function(k,l){if(j.getView().queryData.form)delete j.getView().queryData.form;delete j.getView().queryData.type;},g.SUBSCRIBE_NEW)];},disable:function(){this._subscriptions.forEach(function(j){j.unsubscribe();});this._subscriptions=null;}});e.exports=i;});
__d("legacy:SearchFilterTypeaheadBehavior",["TypeaheadSearchFilter"],function(a,b,c,d){var e=b('TypeaheadSearchFilter');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.initFilters=function(f){f.enableBehavior(e);};},3);
__d("TypeaheadDetectQueryLocale",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._typeahead=i;this._data=i.getData();this._queryCache={'':this._data.queryCache,ja_JP:{},zh_TW:{}};}g(h.prototype,{enable:function(){this._previousLocale='';this._reset=this._typeahead.subscribe('reset',this._swapQueryCache.bind(this,''));this._beforeQuery=this._data.subscribe('beforeQuery',function(i,j){var k=j.value;if(k===''){this._swapQueryCache('');return;}var l=null,m=k.charCodeAt(k.length-1);if(12352<=m&&m<=12543){l='ja_JP';}else if(12544<=m&&m<=12735)l='zh_TW';this._swapQueryCache(l);}.bind(this));},disable:function(){this._swapQueryCache('');this._data.unsubscribe(this._beforeQuery);this._typeahead.ubsubscribe(this._reset);},_swapQueryCache:function(i){if(i===null||i===this._previousLocale)return;this._data.queryCache=this._queryCache[i];this._data.setQueryData({query_locale:i});this._previousLocale=i;}});e.exports=h;});
__d("TypeaheadExcludeBootstrapFromQueryCache",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._data=i.getData();}g(h.prototype,{enable:function(){this._buildingQueryCache=false;this._buildQueryCache=this._data.subscribe('buildQueryCache',function(){this._buildingQueryCache=true;}.bind(this));this._mergeUids=this._data.subscribe('mergeUids',function(i,j){if(this._buildingQueryCache)j.local_uids.splice(0,j.local_uids.length);}.bind(this));this._fetchComplete=this._data.subscribe('fetchComplete',function(){this._buildingQueryCache=false;}.bind(this));},disable:function(){this._data.unsubscribe(this._buildQueryCache);this._data.unsubscribe(this._mergeUids);this._data.unsubscribe(this._fetchComplete);}});e.exports=h;});
__d("TypeaheadSearchBrowseUpsell",["copyProperties","CSS","DOM","emptyFunction","Event"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('CSS'),i=b('DOM'),j=b('emptyFunction'),k=b('Event'),l;function m(n){this._typeahead=n;}g(m,{registerButton:function(n){l=n;}});g(m.prototype,{enable:function(){var n=this._typeahead.view,o=n.buildSeeMore;n.buildSeeMore=function(p,q){var r=o.call(this,p,q);if(q>0){var s=l.cloneNode(true);k.listen(s,'mouseup',function(t){return t.stop();});h.addClass(r.node,'browseInfo');i.appendContent(r.node,s);}return r;};},disable:j});e.exports=m;});
__d("TypeaheadRegulateMemorializedUsers",["copyProperties","TypeaheadUtil"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('TypeaheadUtil');function i(j){this._typeahead=j;}g(i.prototype,{_filterRegistry:null,_filter:function(j,k){if(j.type!=='user'||!j.memorialized)return true;var l=h.parse(j.text).tokens;if(l.length===1&&h.isExactMatch(k,j.text))return true;var m=this._typeahead.getData().getTextToIndex(j),n=h.parse(k).tokens;return (n.length>1&&h.isQueryMatch(k,m));},enable:function(){this._filterRegistry=this._typeahead.getData().addFilter(this._filter.bind(this));},disable:function(){this._filterRegistry.remove();this._filterRegistry=null;}});e.exports=i;});
__d("legacy:RegulateMemorializedUsersTypeaheadBehavior",["TypeaheadRegulateMemorializedUsers"],function(a,b,c,d){var e=b('TypeaheadRegulateMemorializedUsers');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.regulateMemorializedUsers=function(f){f.enableBehavior(e);};},3);